<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"https://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="https://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>progs2016 先生のメモ</title>
<!-- 2016-10-25 火 10:05 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="suzuki@cis.iwate-u.ac.jp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="https://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="https://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">progs2016 先生のメモ</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. card_display_simple</a>
<ul>
<li><a href="#sec-1-1">1.1. 問題</a></li>
<li><a href="#sec-1-2">1.2. 解プログラムの作成の流れ</a>
<ul>
<li><a href="#sec-1-2-1">simple_-1.c</a>
<ul>
<li><a href="#sec-1-2-1-1">やるべきこと</a>
<ul>
<li><a href="#sec-1-2-1-1-1">部分的にプログラムを書いてみる:</a></li>
<li><a href="#sec-1-2-1-1-2">よさそうなので，コマンドラインから文字列もらうように書く</a></li>
</ul>
</li>
<li><a href="#sec-1-2-1-2"><code>card_string</code> 関数について考える</a></li>
<li><a href="#sec-1-2-1-3"><code>card_string</code> 関数を使うmainを書く</a></li>
<li><a href="#sec-1-2-1-4"><code>char *card_string(char *, char *)</code> の入口出口ついて考える</a></li>
<li><a href="#sec-1-2-1-5">simple_-1.c</a></li>
<li><a href="#sec-1-2-1-6">simple_-1.c をコンパイルする Makefile</a></li>
<li><a href="#sec-1-2-1-7">make</a></li>
<li><a href="#sec-1-2-1-8">実行</a></li>
</ul>
</li>
<li><a href="#sec-1-2-2">simple_0.c</a>
<ul>
<li><a href="#sec-1-2-2-1">suit_char 関数</a></li>
<li><a href="#sec-1-2-2-2">no_char 関数</a></li>
<li><a href="#sec-1-2-2-3">simple_0.c</a></li>
<li><a href="#sec-1-2-2-4">make</a></li>
</ul>
</li>
<li><a href="#sec-1-2-3">card_string をテストするコード</a>
<ul>
<li><a href="#sec-1-2-3-1">make</a></li>
<li><a href="#sec-1-2-3-2">simple_0.1.c のまとめ</a></li>
</ul>
</li>
<li><a href="#sec-1-2-4">simple_1.c カードの作成</a>
<ul>
<li><a href="#sec-1-2-4-1">リファクタリング (プログラミング) - Wikipedia とは</a></li>
<li><a href="#sec-1-2-4-2">card_string関数のリファクタリング</a></li>
<li><a href="#sec-1-2-4-3">カード構造体を作る</a>
<ul>
<li><a href="#sec-1-2-4-3-1">文字列で与えられたスーツ(文字列)を整数にする関数</a></li>
<li><a href="#sec-1-2-4-3-2">番号文字列を数字にする関数</a></li>
</ul>
</li>
<li><a href="#sec-1-2-4-4">カードを文字列にする関数 card_to_string</a></li>
</ul>
</li>
<li><a href="#sec-1-2-5">simple_1.c</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. Todo test_sort() がクラッシュする原因</a>
<ul>
<li><a href="#sec-2-1">2.1. 教訓</a></li>
<li><a href="#sec-2-2">2.2. お願い</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Doing org-mode + babelでの literate programming 実践</a></li>
<li><a href="#sec-4">4. C言語あれこれ</a>
<ul>
<li><a href="#sec-4-1">4.1. 共有ライブラリーを解剖する</a></li>
<li><a href="#sec-4-2">4.2. ライブラリの作り方</a></li>
<li><a href="#sec-4-3">4.3. Cコンパイラのオプション</a></li>
<li><a href="#sec-4-4">4.4. ヘッダファイルを二回インクルードしない</a></li>
</ul>
</li>
<li><a href="#sec-5">5. Card モジュールの開発</a>
<ul>
<li><a href="#sec-5-1">5.1. 5/16 (5)</a>
<ul>
<li><a href="#sec-5-1-1">について考える</a></li>
</ul>
</li>
<li><a href="#sec-5-2">5.2. 5/23 (6)</a>
<ul>
<li><a href="#sec-5-2-1">~/progs/Game/Card の確認</a></li>
<li><a href="#sec-5-2-2">について考える</a></li>
<li><a href="#sec-5-2-3">最初に，Card を使うプログラム（テスト）を考える</a></li>
</ul>
</li>
<li><a href="#sec-5-3">5.3. 6/3 (7)</a>
<ul>
<li><a href="#sec-5-3-1">Card に印刷機能を追加しよう</a></li>
</ul>
</li>
<li><a href="#sec-5-4">5.4. 6/10 (8)</a>
<ul>
<li><a href="#sec-5-4-1">Card に比較機能を追加しよう</a></li>
<li><a href="#sec-5-4-2">Card をモジュールとして提供できるようにしよう</a></li>
<li><a href="#sec-5-4-3"></a></li>
<li><a href="#sec-5-4-4">Card モジュールを使ってみる</a></li>
<li><a href="#sec-5-4-5">サブバージョンを使い始めよう</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-6">6. Cardの機能</a></li>
<li><a href="#sec-7">7. テスト駆動開発について</a>
<ul>
<li><a href="#sec-7-1">7.1. 入門サイト</a></li>
<li><a href="#sec-7-2">7.2. やりたいこと</a></li>
</ul>
</li>
<li><a href="#sec-8">8. emacs</a></li>
<li><a href="#sec-9">9. ソフトウェア構成論の環境設定について</a>
<ul>
<li><a href="#sec-9-1">9.1. ./.ckpt</a></li>
<li><a href="#sec-9-2">9.2. 開発ディレクトリ</a></li>
<li><a href="#sec-9-3">9.3. ~/progs でシンボリックリンクする</a></li>
<li><a href="#sec-9-4">9.4. ~/progs/{Game, Trigo, Reports}</a>
<ul>
<li><a href="#sec-9-4-1">サブディレクトリの作成</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-10">10. モジュールとは</a>
<ul>
<li><a href="#sec-10-1">10.1. モジュールのイメージ</a>
<ul>
<li><a href="#sec-10-1-1">関数</a></li>
<li><a href="#sec-10-1-2">機能</a></li>
</ul>
</li>
<li><a href="#sec-10-2">10.2. モジュールとは部品</a>
<ul>
<li><a href="#sec-10-2-1">部品の利用</a></li>
<li><a href="#sec-10-2-2">部品の提供</a></li>
</ul>
</li>
<li><a href="#sec-10-3">10.3. Ubuntu/C言語を使ったモジュールプログラミング</a>
<ul>
<li><a href="#sec-10-3-1">利用側</a>
<ul>
<li><a href="#sec-10-3-1-1">提供側</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-11">11. ソフトウェア構成論 (昔の説明@wiki)</a>
<ul>
<li><a href="#sec-11-1">11.1. 道具達の使い方</a></li>
<li><a href="#sec-11-2">11.2. 自前の関数を作り，利用する</a>
<ul>
<li><a href="#sec-11-2-1">度が使えるsin関数を作る</a>
<ul>
<li><a href="#sec-11-2-1-1">ライブラリの sin を調べる</a></li>
<li><a href="#sec-11-2-1-2">引数を度で渡すと，sin関数値を計算する関数</a>
<ul>
<li><a href="#sec-11-2-1-2-1">名前と引数の型と結果の型を決める</a></li>
<li><a href="#sec-11-2-1-2-2">この決まりごとをヘッダファイルに書いておく</a></li>
<li><a href="#sec-11-2-1-2-3">に関数の振る舞いをプログラムする</a></li>
<li><a href="#sec-11-2-1-2-4">d_sin.c をコンパイルしてみる</a></li>
</ul>
</li>
<li><a href="#sec-11-2-1-3">角度を入力したらそのsin値を計算するプログラムを書く</a>
<ul>
<li><a href="#sec-11-2-1-3-1"></a></li>
<li><a href="#sec-11-2-1-3-2">sin(deg_to_rad(atof(argv\[1\]))) の計算</a></li>
<li><a href="#sec-11-2-1-3-3">コンパイルして calc_d_sin.o を作る</a></li>
<li><a href="#sec-11-2-1-3-4">d_sin.o と calc_d_sin.o （とライブラリ)をリンクして，実行プログラムを作る</a></li>
</ul>
</li>
<li><a href="#sec-11-2-1-4">make</a>
<ul>
<li><a href="#sec-11-2-1-4-1">実行プログラムを作成するまでにおこなったコマンド</a></li>
<li><a href="#sec-11-2-1-4-2">Makefile にこれらを記述</a></li>
</ul>
</li>
<li><a href="#sec-11-2-1-5">バージョン管理</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-12">12. ソフトウェア構成論の受講の準備</a>
<ul>
<li><a href="#sec-12-1">12.1. 開発ディレクトリ</a></li>
<li><a href="#sec-12-2">12.2. Wiki</a></li>
<li><a href="#sec-12-3">12.3. C言語</a></li>
<li><a href="#sec-12-4">12.4. 開発環境</a>
<ul>
<li><a href="#sec-12-4-1">Emacs</a></li>
<li><a href="#sec-12-4-2">make</a></li>
<li><a href="#sec-12-4-3">GCC</a></li>
<li><a href="#sec-12-4-4">シェルとスクリプト</a></li>
<li><a href="#sec-12-4-5"></a></li>
</ul>
</li>
<li><a href="#sec-12-5">12.5. 連絡方法</a></li>
</ul>
</li>
<li><a href="#sec-13">13. shell</a>
<ul>
<li><a href="#sec-13-1">13.1. ディレクトリ</a></li>
<li><a href="#sec-13-2">13.2. ファイル</a></li>
</ul>
</li>
<li><a href="#sec-14">14. ソフトウェア構成論 svnあれこれ</a>
<ul>
<li><a href="#sec-14-1">14.1. h22j018</a>
<ul>
<li><a href="#sec-14-1-1">対策</a></li>
</ul>
</li>
<li><a href="#sec-14-2">14.2. h22j016</a>
<ul>
<li><a href="#sec-14-2-1">症状</a></li>
<li><a href="#sec-14-2-2">対策</a></li>
</ul>
</li>
<li><a href="#sec-14-3">14.3. h22j086</a>
<ul>
<li><a href="#sec-14-3-1">症状</a></li>
<li><a href="#sec-14-3-2">対策</a></li>
</ul>
</li>
<li><a href="#sec-14-4">14.4. h22j124</a>
<ul>
<li><a href="#sec-14-4-1">対策</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-15">15. subversion 6/4</a>
<ul>
<li><a href="#sec-15-1">15.1. コミットの時にviが動いたとき</a></li>
<li><a href="#sec-15-2">15.2. 認証設定の確認</a></li>
<li><a href="#sec-15-3">15.3. バージョン管理コマンド</a></li>
<li><a href="#sec-15-4">15.4. 学生さんの感想とか</a></li>
<li><a href="#sec-15-5">15.5. Cardモジュールをリポジトリにコミットする</a></li>
</ul>
</li>
<li><a href="#sec-16">16. 「VC（バージョンコントロール）パッケージの基礎」(菅原泰樹) — ありえるえりあ</a>
<ul>
<li><a href="#sec-16-1">16.1. VCとは</a></li>
<li><a href="#sec-16-2">16.2. バージョン管理システム</a></li>
<li><a href="#sec-16-3">16.3. 代表的なVCを操作するコマンド</a></li>
<li><a href="#sec-16-4">16.4. 差分の表示</a></li>
<li><a href="#sec-16-5">16.5. 注釈の表示</a></li>
<li><a href="#sec-16-6">16.6. 履歴の表示</a></li>
<li><a href="#sec-16-7">16.7. 更新系の操作</a></li>
<li><a href="#sec-16-8">16.8. 衝突の解決</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="./">ホーム</a> /
<a href="./lects.html">講義</a> / 
<a href="./supplement.html">説明</a> / 
<a href="./org-docs.html">資料</a> / 
<a href="./memos.html">雑メモ</a> /
<a href="https://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/">2015</a>
</p>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> card_display_simple</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 問題</h3>
<div class="outline-text-3" id="text-1-1">
<pre class="example">
% card_display heart 10 
&gt; H0         # と表示される
</pre>

<pre class="example">
% card_display spade 13 
&gt; SK         # と表示される
</pre>

<pre class="example">
% card_display diamond 1 
&gt; DA         # と表示される
</pre>

<pre class="example">
% card_display club 2
&gt; C2           # と表示される
</pre>
</div>
</div>


<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> 解プログラムの作成の流れ</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">simple_-1.c</h4>
<div class="outline-text-4" id="text-1-2-1">
</div><div id="outline-container-sec-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1">やるべきこと</h5>
<div class="outline-text-5" id="text-1-2-1-1">
<ul class="org-ul">
<li>コマンドラインとのやり取りは一旦忘れる (後で)。
</li>
<li>スーツと番号の文字列から表示用文字列を作る。
</li>
<li>表示用文字列を画面に表示する。
</li>
</ul>
</div>

<div id="outline-container-sec-1-2-1-1-1" class="outline-6">
<h6 id="sec-1-2-1-1-1">部分的にプログラムを書いてみる:</h6>
<div class="outline-text-6" id="text-1-2-1-1-1">
<pre class="example">
str = card_string("heart", "10");
puts(str);
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-1-1-2" class="outline-6">
<h6 id="sec-1-2-1-1-2">よさそうなので，コマンドラインから文字列もらうように書く</h6>
<div class="outline-text-6" id="text-1-2-1-1-2">
<div class="org-src-container">

<pre class="src src-c">// 入力
suit_string = argv[1];
no_string = argv[2];
str = card_string(suit_string, no_string);
puts(str);
</pre>
</div>

<p>
よさそう。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2"><code>card_string</code> 関数について考える</h5>
<div class="outline-text-5" id="text-1-2-1-2">
<ul class="org-ul">
<li><code>card_string</code> という名前をもった処理
</li>
<li>スーツと番号の文字列をもらって，
</li>
<li>表示用文字列を作って返す
</li>
</ul>

<p>
つまり, 下記の宣言となります:
</p>
<div class="org-src-container">

<pre class="src src-c">char *card_string(char *, char *);
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3"><code>card_string</code> 関数を使うmainを書く</h5>
<div class="outline-text-5" id="text-1-2-1-3">
<p>
忘れないうちに，main関数を書いてみます:
</p>

<div class="org-src-container">

<pre class="src src-c">// simple.c#main()
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

char * card_string(char *, char *);

int
main(int argc, char *argv[])
{
  char * suit_string = argv[1];
  char * no_string = argv[2];
  char * str = card_string(suit_string, no_string);
  puts(str);
  exit(0);
}
</pre>
</div>

<p>
よさそう。とりあえず，main 関数はこれで完成。
</p>
</div>
</div>

<div id="outline-container-sec-1-2-1-4" class="outline-5">
<h5 id="sec-1-2-1-4"><code>char *card_string(char *, char *)</code> の入口出口ついて考える</h5>
<div class="outline-text-5" id="text-1-2-1-4">
<p>
入力引数の型と戻り値の型は既に決っているので，変数の名前を決めます:
</p>

<ul class="org-ul">
<li>最初の引数の名前は，~suit_string~ (札種を表す文字列の意)
</li>
<li>最初の引数の名前は，~no_string~ (札番号を表す文字列の意)
</li>
</ul>

<p>
ここまで決めると，card_stringの大枠ができます:
</p>
<div class="org-src-container">

<pre class="src src-c">char *card_string(char *suit_string, char *no_string)
{
  char *result;

  //  result = 変換(suit_string, no_string)
  result = "SA";

  return result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-1-5" class="outline-5">
<h5 id="sec-1-2-1-5">simple_-1.c</h5>
<div class="outline-text-5" id="text-1-2-1-5">
<p>
simple0.c の要件を満しませんが，一応コンパイルして実行できるものがで
きました。
</p>

<div class="org-src-container">

<pre class="src src-c">// simple_-1.c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

char * card_string(char *, char *);

int
main(int argc, char *argv[])
{
  char * suit_string = argv[1];
  char * no_string = argv[2];
  char * str = card_string(suit_string, no_string);
  puts(str);
  exit(0);
}

char *card_string(char *suit_string, char *no_string)
{
  char *result;

  //  result = 変換(suit_string, no_string)
  result = "SA";

  return result;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-1-6" class="outline-5">
<h5 id="sec-1-2-1-6">simple_-1.c をコンパイルする Makefile</h5>
<div class="outline-text-5" id="text-1-2-1-6">
<div class="org-src-container">

<pre class="src src-makefile"># Makefile_-1
.PHONY: clean

simple_-1: simple_-1.c
	gcc -o $@ $^ 

clean:
	rm -f *~ \#* *.gch
</pre>
</div>

<ul class="org-ul">
<li><code>.PHONY:</code> は，~clean~ がまぼろしのターゲットであることを定
義しています。
</li>

<li><code>simple_-1</code> ターゲットは，実行プログラム(ファイル)名で，
<ul class="org-ul">
<li><code>: simple_-1.c</code> に依存していて，
</li>

<li><code>simple_-1.c</code> が <code>simple_-1</code> より新らしければ，
</li>

<li>~        gcc -o $@ $^ ~ が <b>シュルコマンド</b> として実行されます。
</li>

<li>実行の前に，~$@~ はターゲット(の名前)に，~$^~ はソースに置き換えら
れ, 次のコマンドとなります:

<pre class="example">
gcc -o simple_-1 simple_-1.c
</pre>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-2-1-7" class="outline-5">
<h5 id="sec-1-2-1-7">make</h5>
<div class="outline-text-5" id="text-1-2-1-7">
<div class="org-src-container">

<pre class="src src-sh">make -f Makefile_-1
</pre>
</div>

<pre class="example">
gcc -o simple_-1 simple_-1.c
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-1-8" class="outline-5">
<h5 id="sec-1-2-1-8">実行</h5>
<div class="outline-text-5" id="text-1-2-1-8">
<div class="org-src-container">

<pre class="src src-sh">./simple_-1 "hoge" "hoge"
</pre>
</div>

<pre class="example">
SA
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">simple_0.c</h4>
<div class="outline-text-4" id="text-1-2-2">
<p>
これから要件を満たすように変更していきましょう。
</p>

<p>
そのためには，card_string 関数を正しく作りなおせば良いでしょう。
</p>

<p>
そしてそのためには，
</p>
<pre class="example">
result = "SA"; 
</pre>

<p>
と書いていた部分を正しい処理に書き換えます。
</p>

<div class="org-src-container">

<pre class="src src-c">{ 
  char suit_c, no_c;
  char suit_char(char *);
  char no_char(char *);

  suit_c = suit_char(suit_string);
  no_c = no_char(no_string);
  result = (char *) malloc(3);
  result[0] = suit_c;
  result[1] = no_c;
  result[2] = '\0';
}
</pre>
</div>

<p>
この中で，また，新しい関数を作ることになりました。
</p>
</div>

<div id="outline-container-sec-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1">suit_char 関数</h5>
<div class="outline-text-5" id="text-1-2-2-1">
<div class="org-src-container">

<pre class="src src-c">char suit_char(char *);
</pre>
</div>

<div class="org-src-container">

<pre class="src src-c">char suit_char(char *suit)
{
  if (strcmp("spade", suit)) return 'S';
  if (strcmp("heart", suit)) return 'H';
  if (strcmp("diamond", suit)) return 'D';
  if (strcmp("club", suit)) return 'C';
  return('?');
}
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2">no_char 関数</h5>
<div class="outline-text-5" id="text-1-2-2-2">
<div class="org-src-container">

<pre class="src src-c">char no_char(char *);
</pre>
</div>

<div class="org-src-container">

<pre class="src src-c">char no_char(char *no)
{
  int n = atoi(no);

  if (n==1) return 'A';
  if (n==13) return 'K';
  if (n==12) return 'Q';
  if (n==11) return 'J';
  if (n==10) return '0';
  return '0'+n;
}
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3">simple_0.c</h5>
<div class="outline-text-5" id="text-1-2-2-3">
<p>
まとめると:
</p>

<div class="org-src-container">

<pre class="src src-c">// simple_0.c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

char * card_string(char *, char *);

int
main(int argc, char *argv[])
{
  char * suit_string = argv[1];
  char * no_string = argv[2];
  char * str = card_string(suit_string, no_string);
  puts(str);
  exit(0);
}

char *card_string(char *suit_string, char *no_string)
{
  char *result;

  { 
    char suit_c, no_c;
    char suit_char(char *);
    char no_char(char *);

    suit_c = suit_char(suit_string);
    no_c = no_char(no_string);
    result = (char *) malloc(3);
    result[0] = suit_c;
    result[1] = no_c;
    result[2] = '\0';
  }

  return result;
}


char suit_char(char *suit)
{
  if (strcmp("spade", suit)==0) return 'S';
  if (strcmp("heart", suit)==0) return 'H';
  if (strcmp("diamond", suit)==0) return 'D';
  if (strcmp("club", suit)==0) return 'C';
  return('?');
} 

char no_char(char *no)
{
  int n = atoi(no);

  if (n==1) return 'A';
  if (n==13) return 'K';
  if (n==12) return 'Q';
  if (n==11) return 'J';
  if (n==10) return '0';
  return '0'+n;
}
</pre>
</div>

<p>
Makefile は変更ありません:
</p>

<div class="org-src-container">

<pre class="src src-makefile"># Makefile_0
.PHONY: clean

simple_0: simple_0.c
	gcc -o $@ $^ 

clean:
	rm -f *~ \#* *.gch
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-2-4" class="outline-5">
<h5 id="sec-1-2-2-4">make</h5>
<div class="outline-text-5" id="text-1-2-2-4">
<div class="org-src-container">

<pre class="src src-sh">make -f Makefile_0
</pre>
</div>

<pre class="example">
cc     simple_0.c   -o simple_0
</pre>

<div class="org-src-container">

<pre class="src src-sh">./simple_0 heart 10
./simple_0 spade 1
./simple_0 diamond 13
./simple_0 club 2
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">H0</td>
</tr>

<tr>
<td class="left">SA</td>
</tr>

<tr>
<td class="left">DK</td>
</tr>

<tr>
<td class="left">C2</td>
</tr>
</tbody>
</table>

<p>
simple_0.c 完成です。
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">card_string をテストするコード</h4>
<div class="outline-text-4" id="text-1-2-3">
<p>
card_string は関数で，満すべき性質は下記のように書くことができます:
</p>
<div class="org-src-container">

<pre class="src src-c">if (strcmp(card_string("diamond", "1"), "DA")==0) puts("OK"); else puts("NG"); 
if (strcmp(card_string("spade", "13"), "SK")==0)  puts("OK"); else puts("NG"); 
if (strcmp(card_string("spade", "12"), "SQ")==0)  puts("OK"); else puts("NG"); 
if (strcmp(card_string("spade", "11"), "SJ")==0)  puts("OK"); else puts("NG"); 
if (strcmp(card_string("heart", "10"), "H0")==0)  puts("OK"); else puts("NG"); 
if (strcmp(card_string("club", "9"), "C9")==0) puts("OK"); else puts("NG"); 
if (strcmp(card_string("club", "2"), "C2")==0) puts("OK"); else puts("NG");
</pre>
</div>

<p>
main関数の中で，card_string が呼ばれる前に，このテストを実行し，
card_string の実装が正しいことを，プログラム自身で確かめるようにしてみ
ます。
</p>


<div class="org-src-container">

<pre class="src src-c">// simple_0.1.c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

char * card_string(char *, char *);

int
main(int argc, char *argv[])
{
  char * suit_string = argv[1];
  char * no_string = argv[2];
  char * str;

  {
    void test_card_string(void);

    test_card_string();
  }

  str = card_string(suit_string, no_string);
  puts(str);
  exit(0);
}

void
test_card_string(void)
{
  if (strcmp(card_string("diamond", "1"), "DA")==0) puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "13"), "SK")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "12"), "SQ")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "11"), "SJ")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("heart", "10"), "H0")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("club", "9"), "C9")==0) puts("OK"); else puts("NG"); 
  if (strcmp(card_string("club", "2"), "C2")==0) puts("OK"); else puts("NG");
}

char *card_string(char *suit_string, char *no_string)
{
  char *result;

  { 
    char suit_c, no_c;
    char suit_char(char *);
    char no_char(char *);

    suit_c = suit_char(suit_string);
    no_c = no_char(no_string);
    result = (char *) malloc(3);
    result[0] = suit_c;
    result[1] = no_c;
    result[2] = '\0';
  }

  return result;
}

char suit_char(char *suit)
{
  if (strcmp("spade", suit)==0) return 'S';
  if (strcmp("heart", suit)==0) return 'H';
  if (strcmp("diamond", suit)==0) return 'D';
  if (strcmp("club", suit)==0) return 'C';
  return('?');
} 

char no_char(char *no)
{
  int n = atoi(no);

  if (n==1) return 'A';
  if (n==13) return 'K';
  if (n==12) return 'Q';
  if (n==11) return 'J';
  if (n==10) return '0';
  return '0'+n;
}
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-3-1" class="outline-5">
<h5 id="sec-1-2-3-1">make</h5>
<div class="outline-text-5" id="text-1-2-3-1">
<div class="org-src-container">

<pre class="src src-sh">make -f Makefile_0.1
</pre>
</div>

<pre class="example">
gcc -o simple_0.1 simple_0.1.c
</pre>

<div class="org-src-container">

<pre class="src src-sh">./simple_0.1 heart 13
</pre>
</div>

<p>
OKですね。
</p>
</div>
</div>

<div id="outline-container-sec-1-2-3-2" class="outline-5">
<h5 id="sec-1-2-3-2">simple_0.1.c のまとめ</h5>
<div class="outline-text-5" id="text-1-2-3-2">
<p>
次の関数を作った:
</p>
<dl class="org-dl">
<dt> <code>char * card_string(char *suit_string, char *no_string);</code> </dt><dd>     
</dd>

<dt> <code>char suit_char(char *suit);</code> </dt><dd>     
</dd>

<dt> <code>char no_char(char *no);</code> </dt><dd>
</dd>

<dt> <code>void test_card_string(void);</code> </dt><dd></dd>
</dl>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">simple_1.c カードの作成</h4>
<div class="outline-text-4" id="text-1-2-4">
<p>
simple_0.1.c では，カードという <b>物</b> が現われていません。
</p>

<p>
今後，複数のカードの入力や，それらのソート機能が求められるため，
カードを作ることにします。
</p>
</div>

<div id="outline-container-sec-1-2-4-1" class="outline-5">
<h5 id="sec-1-2-4-1"><a href="https://ja.wikipedia.org/wiki/%E3%83%AA%E3%83%95%E3%82%A1%E3%82%AF%E3%82%BF%E3%83%AA%E3%83%B3%E3%82%B0_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0)">リファクタリング (プログラミング) - Wikipedia</a> とは</h5>
<div class="outline-text-5" id="text-1-2-4-1">
<blockquote>
<p>
リファクタリング (refactoring) とは、コンピュータプログラミングにおい
て、プログラムの外部から見た動作を変えずにソースコードの内部構造を整理
することである。
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-1-2-4-2" class="outline-5">
<h5 id="sec-1-2-4-2">card_string関数のリファクタリング</h5>
<div class="outline-text-5" id="text-1-2-4-2">
<p>
入力の suit_string と no_string から，表示文字列を作る前に，
いったん一枚のカードを作ることにします。
</p>

<p>
すると，カードを作る前と後の処理を別々に考えやすくなります。
<code>card_string</code> 関数の処理の流れは次のようになります:
</p>

<ul class="org-ul">
<li>あるカード = カードの作成(suit_string, no_string)

<p>
<code>Card a_card = card_new_from_string(suit_string, no_string);</code>
</p>
</li>

<li>result = カードの表示文字列を作る(あるカード)

<p>
<code>result = card_to_string(a_card);</code>
</p>
</li>
</ul>

<p>
カードを作るということは，カードの構造を持った構造体を作ることに
なります。
</p>
</div>
</div>


<div id="outline-container-sec-1-2-4-3" class="outline-5">
<h5 id="sec-1-2-4-3">カード構造体を作る</h5>
<div class="outline-text-5" id="text-1-2-4-3">
<p>
取り敢えず，カードが持つ情報は次の2つとします:
</p>

<ul class="org-ul">
<li>スーツを表わす整数値
</li>
<li>番号を表わす整数値
</li>
</ul>

<p>
どちらも整数値としたのは，カードの強さを，数の大小関係で表わすた
めです。
</p>

<p>
スーツの整数値と番号の整数値をもつ構造体型に，_Cardと名前を付けて，
定義します:
</p>

<div class="org-src-container">

<pre class="src src-c">struct _Card {
  int suit;
  int no;
};
</pre>
</div>

<div class="org-src-container">

<pre class="src src-c">typdef struct _Card Card;
</pre>
</div>

<p>
カードを作るための関数を作ります。
また，~card_string~ で使うために，スーツや番号を表す文字列を与えてカー
ドを作る関数も併せて作ります。
</p>

<div class="org-src-container">

<pre class="src src-c">Card card_new(int suit, int no) 
{
  Card new;

  new.suit = suit;
  new.no = no;

  return new;
}

Card card_new_from_string(char *suit_str, char *no_str)
{
  int suit = card_suit_from_string(suit_str);
  int no = card_no_from_string(no_str);

  return card_new(suit, no);
}
</pre>
</div>

<p>
ここで，~card_string~ がきちんと書けます:
</p>

<div class="org-src-container">

<pre class="src src-c">char *card_string(char *suit_string, char *no_string)
{
  char *result;

  {
    Card card_new_from_string(char *, char *);
    Card card;
    char *card_to_string(Card);

    card = card_new_from_string(suit_string, no_string);

    result = card_to_string(card);
  }

  return result;
}
</pre>
</div>
</div>

<div id="outline-container-sec-1-2-4-3-1" class="outline-6">
<h6 id="sec-1-2-4-3-1">文字列で与えられたスーツ(文字列)を整数にする関数</h6>
<div class="outline-text-6" id="text-1-2-4-3-1">
<p>
<code>card_new_from_string</code> 関数では次のように書きました:
</p>

<div class="org-src-container">

<pre class="src src-c">int suit = card_suit_from_string(suit_string);
</pre>
</div>

<p>
<code>card_suit_from_string</code> が満たすべきことをCで書いてみましょう:
</p>

<div class="org-src-container">

<pre class="src src-c">if (card_suit_from_string("spade") != 4) puts("error");
if (card_suit_from_string("heart") != 3) puts("error");
if (card_suit_from_string("diamond") != 2) puts("error");
if (card_suit_from_string("club") != 1) puts("error");
</pre>
</div>

<p>
うまく使えそうです。これでいいでしょう。
すると，card_suit_from_string のプロトタイプ宣言が書けます:
</p>

<div class="org-src-container">

<pre class="src src-c">int card_suit_from_string(char *);
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-4-3-2" class="outline-6">
<h6 id="sec-1-2-4-3-2">番号文字列を数字にする関数</h6>
<div class="outline-text-6" id="text-1-2-4-3-2">
<p>
続いて，カード番号について，プログラム内部表現への変換を，スーツ同様に，
書いてみましょう:
</p>

<div class="org-src-container">

<pre class="src src-c">int no =  card_no_from_string(no_str);
</pre>
</div>

<p>
<code>card_no_from_string</code> が満たすべきことをCで書いてみましょう:
</p>
<div class="org-src-container">

<pre class="src src-c">if (card_no_from_string("13") == 13 ) puts("OK"); else puts("NG");
if (card_no_from_string("12") == 12 ) puts("OK"); else puts("NG");
if (card_no_from_string("2") == 2 ) puts("OK"); else puts("NG");
if (card_no_from_string("1") == 14 ) puts("OK"); else puts("NG");
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-2-4-4" class="outline-5">
<h5 id="sec-1-2-4-4">カードを文字列にする関数 card_to_string</h5>
<div class="outline-text-5" id="text-1-2-4-4">
<p>
<code>card_to_string</code> の使われかたは，次でした:
</p>
<div class="org-src-container">

<pre class="src src-c">str = card_to_string(card)
</pre>
</div>

<p>
スーツと番号を表す数字をそれぞれ文字にする関数を考えます。
</p>

<ul class="org-ul">
<li><code>card_suit_to_char(card)</code>
</li>
<li><code>card_no_to_string(card)</code>
</li>
</ul>

<p>
すると，~card_to_string~ が書けます:
</p>
<div class="org-src-container">

<pre class="src src-c">char *
card_to_string(Card card)
{
char suit_char = card_suit_to_char(card);
char no_char = card_no_to_char(card);
char *result = (char *) malloc(3);

result[0] = suit_char;
result[1] = no_char;
result[2] = 0;

return result;
}
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5">simple_1.c</h4>
<div class="outline-text-4" id="text-1-2-5">
<div class="org-src-container">

<pre class="src src-c">// simple_1.c
# include &lt;stdio.h&gt;
# include &lt;stdlib.h&gt;
# include &lt;string.h&gt;

struct _Card {
  int suit;
  int no;
};

typedef struct _Card Card;

char *card_string(char *, char *);


Card card_new_from_string(char *, char *);
Card card_new(int, int);
int card_suit_from_string(char *);
int card_no_from_string(char *);

char *card_to_string(Card);
char card_suit_to_char(Card);
char card_no_to_char(Card);

int
main(int argc, char *argv[])
{
  char * suit_string = argv[1];
  char * no_string = argv[2];
  char * str;

  {
    void test_card_string(void);
    void test_card_suit_from_string(void);
    void test_card_no_from_string(void);

    test_card_suit_from_string();
    test_card_no_from_string();
    test_card_string();
  }

  str = card_string(suit_string, no_string);
  puts(str);

  exit(0);
}

void
test_card_string(void)
{
  if (strcmp(card_string("diamond", "1"), "DA")==0) puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "13"), "SK")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "12"), "SQ")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("spade", "11"), "SJ")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("heart", "10"), "H0")==0)  puts("OK"); else puts("NG"); 
  if (strcmp(card_string("club", "9"), "C9")==0) puts("OK"); else puts("NG"); 
  if (strcmp(card_string("club", "2"), "C2")==0) puts("OK"); else puts("NG");
}


char *card_string(char *suit_string, char *no_string)
{
  char *result;

  {
    Card a = card_new_from_string(suit_string, no_string);

    result = card_to_string(a);
  }

  return result;
}

void
test_card_suit_from_string(void)
{
if (card_suit_from_string("spade") != 4) puts("error");
if (card_suit_from_string("heart") != 3) puts("error");
if (card_suit_from_string("diamond") != 2) puts("error");
if (card_suit_from_string("club") != 1) puts("error");
}

void
test_card_no_from_string(void)
{
  if (card_no_from_string("13") == 13 ) puts("OK"); else puts("NG");
  if (card_no_from_string("12") == 12 ) puts("OK"); else puts("NG");
  if (card_no_from_string("2") == 2 ) puts("OK"); else puts("NG");
  if (card_no_from_string("1") == 14 ) puts("OK"); else puts("NG");
}

Card card_new_from_string(char *suit_str, char *no_str)
{
  int suit = card_suit_from_string(suit_str);
  int no = card_no_from_string(no_str);

  return card_new(suit, no);
}


Card card_new(int suit, int no) 
{
  Card new;

  new.suit = suit;
  new.no = no;

  return new;
}

char *
card_to_string(Card card)
{
  char suitc = card_suit_to_char(card);
  char noc = card_no_to_char(card);
  char *result = (char *) malloc(3);

  result[0] = suitc;
  result[1] = noc;
  result[2] = 0;

  return result;
}

int 
card_suit_from_string(char *suit)
{
  if (strcmp("spade", suit)==0) return 4;
  if (strcmp("heart", suit)==0) return 3;
  if (strcmp("diamond", suit)==0) return 2;
  if (strcmp("club", suit)==0) return 1;
  return('?');
} 

# define SPADE 4
# define HEART 3
# define DIAMOND 2
# define CLUB 1

char
card_suit_to_char(Card c)
{
  if (c.suit==SPADE) return 'S';
  if (c.suit==HEART) return 'H';
  if (c.suit==DIAMOND) return 'D';
  if (c.suit==CLUB) return 'C';
  return('?');
} 

# define ACE 14
# define KING 13
# define QUEEN 12
# define JACK 11

int 
card_no_from_string(char *no)
{
  int n = atoi(no);

  if (n==1) n = ACE;
  return n;
}

char
card_no_to_char(Card c)
{
  int n = c.no;

  if (n==ACE) return 'A';
  if (n==KING) return 'K';
  if (n==QUEEN) return 'Q';
  if (n==JACK) return 'J';
  if (n==10) return '0';
  return '0'+n;
}
</pre>
</div>

<div class="org-src-container">

<pre class="src src-makefile"># Makefile_1
.PHONY: clean

simple_1: simple_1.c
	gcc -o $@ $^ 

clean:
	rm -f *~ \#* *.gch
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">make clean
make -f Makefile_1
./simple_1 heart 1
</pre>
</div>

<pre class="example">
gcc -o simple_1 simple_1.c 
OK
OK
OK
OK
OK
OK
OK
OK
OK
OK
OK
HA
</pre>
<hr  />
</div>
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Todo test_sort() がクラッシュする原因</h2>
<div class="outline-text-2" id="text-2">
<p>
Card *cards に値を入れずに，cards_sort に渡したのが原因です。
</p>

<div class="org-src-container">

<pre class="src src-c">// test/test_sort.c
# include &lt;cutter.h&gt;
# include &lt;card.h&gt;
void
test_cards_sort(void)
{
    Card test_cards[5];
    {
      test_cards[0] = card_new(SPADE,ACE);
      test_cards[1] = card_new(HEART,ACE);
      test_cards[2] = card_new(CLUB,2);
      test_cards[3] = card_new(DIAMOND,10);
      test_cards[4] = card_new(SPADE,2);
    }

    Card expected_cards[5];
    {
      expected_cards[4] = card_new(SPADE,ACE);
      expected_cards[3] = card_new(HEART,ACE);
      expected_cards[2] = card_new(DIAMOND,10);
      expected_cards[1] = card_new(SPADE,2);
      expected_cards[0] = card_new(CLUB,2);
    }

  Card *cards, *sorted_cards;
  {
    // cards = test_cards; // 2015.12.08 fixed
    sorted_cards = cards_sort(cards, 5);
  }

  int i;
  for (i=0; i&lt;5; i++)
    {
      cut_assert(card_compare(expected_cards[i], sorted_cards[i])==0 );
    }
}
</pre>
</div>

<p>
gcc のオプションに， -Wall を付てコンパイルしてみてください。
</p>


<pre class="example">
-*- mode: compilation; default-directory: "~/progs/card_display/simple/test/" -*-
Compilation started at Tue Dec 15 10:16:19

make 
gcc -c -g -Wall -fPIC `pkg-config cutter --cflags` -I../src test_card.c
gcc -o test_card.so -shared test_card.o -L../src -lcard `pkg-config cutter --libs`
gcc -c -g -Wall -fPIC `pkg-config cutter --cflags` -I../src test_sort.c
test_sort.c: In function ‘test_cards_sort’:
test_sort.c:8:10: warning: variable ‘test_cards’ set but not used [-Wunused-but-set-variable]
     Card test_cards[5];
          ^
test_sort.c:29:18: warning: ‘cards’ is used uninitialized in this function [-Wuninitialized]
     sorted_cards = cards_sort(cards, 5);
                  ^
gcc -o test_sort.so -shared test_sort.o -L../src -lcard `pkg-config cutter --libs`

Compilation finished at Tue Dec 15 10:16:19
</pre>

<p>
Warning (警告)は，致命的なエラーではなく，一応コンパイルは通り，.o が
できます。文法的には正しいということです。
</p>

<p>
Warning を無視すると意味的(実行時)におかしくなります。
</p>


<p>
上の警告の意味は:
</p>

<ul class="org-ul">
<li>test_cardss は set されているが，not used であること
</li>

<li>cards は uninitialized であること
</li>
</ul>

<p>
実行時，
</p>

<ul class="org-ul">
<li>cards は，オート変数で，割り当てられたメモリの内容そのままになります。
</li>

<li>cards の値は cards_sort に渡り，cards_sort関数は，それが Card * なの
で，その先の Card を使おうとしますが，

<ul class="org-ul">
<li>そこがデータ領域でなければ, Segment Fault (例外) が起ります。
</li>
<li>そこがデータ領域だった場合は，もっと悪いことに，処理続き，
おこしな振舞をすることになります。
</li>
</ul>
</li>
</ul>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 教訓</h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>gcc のオプションに，-Wall を付てコンパイルし, Warning をチェックする
こと

<ul class="org-ul">
<li>以前は，-Wall がデフォルトだったと思います。現システムでもそうだと
思いこんでいました。
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> お願い</h3>
<div class="outline-text-3" id="text-2-2">
<p>
card_display/simple/ 配下の，Makefile の CFLAGS 変数の値に， -g -Wall
を付け加えてください。
</p>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Doing org-mode + babelでの literate programming 実践</h2>
<div class="outline-text-2" id="text-3">
<ol class="org-ol">
<li>コード類は，機能毎に .org にまとめ，
part 毎に :name を付け，:noweb 機能で，
関数やファイルにまとめる
</li>

<li>.ob =&gt; .org =&gt; tangle (noweb)

<ul class="org-ul">
<li>各機能用のソースコードの生成が主目的
</li>

<li>tangle 時，sh-block は実行しない
</li>
</ul>
</li>

<li>.org から babel_include された部分を削除
</li>

<li>.org 中の sh-blk の実行

<ul class="org-ul">
<li>C-c C-v C-n で sh-blk を見つけ，
</li>

<li>C-c C-c yes で実行していく
</li>

<li>開発プロセスを作る
</li>

<li>実行結果が .org に書き込まれる
</li>
</ul>
</li>
</ol>


<ol class="org-ol">
<li>index.ob =&gt; index.org 

<ul class="org-ul">
<li>文書先頭に noweb コードを表示用に埋めこむ
</li>
</ul>
</li>

<li>org2html index.org 

<ul class="org-ul">
<li>exportのみ
</li>
<li>tangle, sh-blk 実行はしない
</li>
</ul>
</li>
</ol>
<hr  />
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> C言語あれこれ</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 共有ライブラリーを解剖する</h3>
<div class="outline-text-3" id="text-4-1">
<p>
<a href="https://www.ibm.com/developerworks/jp/linux/library/l-shlibs/">共有ライブラリーを解剖する</a>
</p>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> ライブラリの作り方</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>動的ライブラリ 作り方
<a href="https://d.hatena.ne.jp/sleepy_yoshi/20090510/p1">gccを用いたCの共有ライブラリの作り方 - 睡眠不足？！</a>

<p>
CFLAGS = -fPIC
LDFLAGS = &#x2013;shared
</p>
</li>

<li>静的ライブラリ 作り方
<a href="https://qiita.com/edo_m18/items/b9765ff3313d5a13f82f">共有ライブラリと静的ライブラリを整理する - Qiita</a>

<p>
ar r
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Cコンパイラのオプション</h3>
<div class="outline-text-3" id="text-4-3">
<pre class="example">
-I&lt;include_path&gt;, C_INCLUDE_PATH環境変数
-L&lt;library_path&gt;, LIBRARY_PATH環境変数
-l&lt;libname&gt;, 
</pre>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> ヘッダファイルを二回インクルードしない</h3>
<div class="outline-text-3" id="text-4-4">
<pre class="example">
# pragma once
</pre>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Card モジュールの開発</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 5/16 (5)</h3>
<div class="outline-text-3" id="text-5-1">
</div><div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><a href="#sec-6">6</a>について考える</h4>
<div class="outline-text-4" id="text-5-1-1">
<ul class="org-ul">
<li>ポーカーゲームやカードについて考え，
</li>
<li>カードモジュールの内と外を認識し，
</li>
<li>外から内を使う機能，
</li>
<li>内から外へ提供する機能，
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 5/23 (6)</h3>
<div class="outline-text-3" id="text-5-2">
</div><div id="outline-container-sec-5-2-1" class="outline-4">
<h4 id="sec-5-2-1">~/progs/Game/Card の確認</h4>
<div class="outline-text-4" id="text-5-2-1">
<p>
なければ作ってください
</p>

<p>
~/progs/Game/Card がカードモジュールの開発場所です。
</p>
</div>
</div>

<div id="outline-container-sec-5-2-2" class="outline-4">
<h4 id="sec-5-2-2"><a href="#sec-6">6</a>について考える</h4>
</div>

<div id="outline-container-sec-5-2-3" class="outline-4">
<h4 id="sec-5-2-3">最初に，Card を使うプログラム（テスト）を考える</h4>
<div class="outline-text-4" id="text-5-2-3">
<p>
<a href="file:///home/staff/suzuki/progs/Game/Card/">file:///home/staff/suzuki/progs/Game/Card/</a>
</p>

<ol class="org-ol">
<li>テストを書いてみる [[<a href="file:///home/staff/suzuki/progs/Game/Card/">file:///home/staff/suzuki/progs/Game/Card/</a>test_card.c]]

<p>
定石プログラム
</p>
<ul class="org-ul">
<li>card.h のインクルード
</li>
<li>Card 型の変数
</li>
<li>カードを作り，できたことを確認する
</li>
</ul>
</li>

<li>Makefile を作る
<ul class="org-ul">
<li>test_card_1.o ができることが目標
</li>
<li>card.h を作る <a href="file:///home/staff/suzuki/progs/Game/Card/card.h">file:///home/staff/suzuki/progs/Game/Card/card.h</a>
</li>
</ul>
</li>

<li>必要最小限のcard.cを作る <a href="file:///home/staff/suzuki/progs/Game/Card/card.c">file:///home/staff/suzuki/progs/Game/Card/card.c</a>
<ul class="org-ul">
<li>Card 型の値を返す
</li>
<li>番号とスーツを返す関数
</li>
</ul>
</li>

<li>card.o を作る
<ul class="org-ul">
<li>Makefile に card.o を作る規則を書く
</li>
</ul>
</li>

<li>実行できるtest_card を作る
<ul class="org-ul">
<li>Makefile に test_card_1.o と card.o の結合（リンク）を書く
</li>
</ul>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> 6/3 (7)</h3>
<div class="outline-text-3" id="text-5-3">
</div><div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1">Card に印刷機能を追加しよう</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
suit = HEART, no = ACE =&gt; "HA"
suit = CLUB, no=2 =&gt; "C2"
</p>

<p>
この機能の API は，
</p>
<pre class="example">
char * Card_to_str(Card);
</pre>

<ul class="org-ul">
<li>~/progs/Game/Card/card.h に書く
</li>

<li>~/progs/Game/Card/test_print.c にテストを実装
<ul class="org-ul">
<li>カードを一枚作り，印刷する
</li>
</ul>
</li>

<li>Makefile にtest_print.o を作る規則を書く
</li>

<li>~/progs/Game/Card/print.c に Card_to_str を実装
</li>

<li>Makefile にprint.o を作る規則を書く
</li>

<li>test_print を作る
</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> 6/10 (8)</h3>
<div class="outline-text-3" id="text-5-4">
</div><div id="outline-container-sec-5-4-1" class="outline-4">
<h4 id="sec-5-4-1">Card に比較機能を追加しよう</h4>
<div class="outline-text-4" id="text-5-4-1">
<pre class="example">
int card_compare(Card, Card); 
</pre>

<p>
同様に，test_compare, test_compare.{o,c}, compare.{o,c} を作る
</p>
</div>
</div>


<div id="outline-container-sec-5-4-2" class="outline-4">
<h4 id="sec-5-4-2">Card をモジュールとして提供できるようにしよう</h4>
<div class="outline-text-4" id="text-5-4-2">
<ul class="org-ul">
<li>~/progs/Game/Module/card.o
</li>
<li>~/progs/Game/Interface/card.h
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-5-4-3" class="outline-4">
<h4 id="sec-5-4-3"><a href="file:///home/staff/suzuki/progs/Game/Makefile">file:///home/staff/suzuki/progs/Game/Makefile</a></h4>
<div class="outline-text-4" id="text-5-4-3">
<ul class="org-ul">
<li>カードモジュールを最新状態にし，
</li>
<li>モジュール本体を ~progs/Game/Card/card.o へコピーし
</li>
<li>インタフェースを ~progs/Game/Card/card.h へコピーし
</li>
</ul>

<p>
*
</p>
</div>
</div>

<div id="outline-container-sec-5-4-4" class="outline-4">
<h4 id="sec-5-4-4">Card モジュールを使ってみる</h4>
<div class="outline-text-4" id="text-5-4-4">
<p>
いままで作ってきたテストを利用して，
Card モジュールの外からプログラムを書いてみる．
</p>

<ul class="org-ul">
<li>((% mkdir ~/progs/Game/Test %))
</li>
<li>~/progs/Game/Test/card_game.c に下記プログラムを作成する
<ul class="org-ul">
<li>二枚のカードを作り，表示し
</li>
<li>強いカードを表示する
</li>
</ul>
</li>
<li>~/progs/Game/Test/Makefile を作成する
<ul class="org-ul">
<li>~/progs/Game/Interface の下のインクルードファイルが使えるようにする
</li>
<li>~/progs/Game/Module の下のオブジェクトファイルが使えるようにする
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5-4-5" class="outline-4">
<h4 id="sec-5-4-5">サブバージョンを使い始めよう</h4>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Cardの機能</h2>
<div class="outline-text-2" id="text-6">
<p>
カードは，
</p>
<ol class="org-ol">
<li>札種と番号の情報を持つ．
</li>
<li>札種は4種類あり，
</li>
<li>番号には13種類ある．
</li>
<li>2枚のカードの大小比較ができる．
</li>
<li>カードの大小比較は，
<ol class="org-ol">
<li>番号の大きさ (A&gt;K&gt;Q&gt;&#x2026;&gt;3&gt;2) と
</li>
<li>札種の強さ (スペード&gt;ハート&gt;ダイヤ&gt;クラブ) で決まる．
</li>
</ol>
</li>
</ol>

<p>
となりました．
忘れがちですが，
</p>

<ol class="org-ol">
<li>カードを表示する (ための文字列を作る) 
</li>
<li>新しいカードを作る
</li>
</ol>

<p>
機能も必要ですね．
</p>

<p>
カード型の値を作る関数を <b>コンストラクタ</b>, 
カード型の値の属性値を得る関数を <b>セレクタ</b> 
と呼ぶ
</p>
</div>
</div>


<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> テスト駆動開発について</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> 入門サイト</h3>
<div class="outline-text-3" id="text-7-1">
<ul class="org-ul">
<li><a href="https://www.slideshare.net/shuji_w6e/ss-15246933">テスト駆動開発入門</a> (slideshare)
</li>
<li><a href="https://www.atmarkit.co.jp/ait/articles/1403/05/news035.html">いまさら聞けないTDD/BDD超入門（1）：テスト駆動開発／振る舞い駆動開発を始めるための基礎知識 (1/3) - ＠IT</a>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> やりたいこと</h3>
<div class="outline-text-3" id="text-7-2">
<p>
少しづつ，
</p>
<ul class="org-ul">
<li>まず，設計し，
</li>
<li>次に，実装し，
</li>
<li>そして，要求を満たしていることを確かめる，
</li>
<li>今回の変更が，他に影響を及ぼさないことを確かめる
</li>
</ul>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> emacs</h2>
<div class="outline-text-2" id="text-8">
<p>
<a href="https://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs.html">日本語マニュアル</a>
</p>

<ul class="org-ul">
<li>emacs の中でコンパイル
<pre class="example">
M-x compile 
</pre>
<p>
C-a C-k gcc -c -I . calc_d_sin.c
</p>
</li>

<li>開いている先生のファイルを自分のディレクトリに保存する
<pre class="example">
C-x C-w ~/progs/calc_d_sin.c
</pre>
</li>

<li>emacs の中から先生のファイルを開く
<pre class="example">
C-x C-f ~suzuki/progs/suzuki/.... 
</pre>
</li>

<li>ファイルとバッファ
<pre class="example">
C-x C-f ファイルを開きバッファへ
C-x C-s バッファをファイルへセーブ
C-x C-w バッファを別のファイルへ書く
</pre>
</li>

<li>ウィンドウ
<a href="https://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs_17.html">https://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs_17.html</a>

<pre class="example">
C-x 2, C-x 3 横や縦に分ける
C-x o 別のウィンドウへ
C-x 0 ウィンドウを消す
C-x C-b バッファの一覧を表示する
</pre>
</li>
</ul>


<ul class="org-ul">
<li>別のフレーム
<a href="https://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs_18.html#SEC177">https://www.bookshelf.jp/texi/emacs-20.6-man-jp/emacs_18.html#SEC177</a>
<pre class="example">
C-x 5 2 開く
C-x 5 o 行き来する
C-x 5 0 閉じる
</pre>
</li>
</ul>
<hr  />
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> ソフトウェア構成論の環境設定について</h2>
<div class="outline-text-2" id="text-9">
<p>
2014以前
</p>
</div>

<div id="outline-container-sec-9-1" class="outline-3">
<h3 id="sec-9-1"><span class="section-number-3">9.1</span> ./.ckpt</h3>
<div class="outline-text-3" id="text-9-1">
<ul class="org-ul">
<li>バックアップがある，隠しディレクトリです．
</li>
<li>全てのディレクトリにあります．

<pre class="example">
((% cd .ckpt; ls -lR %))
</pre>

<p>
1分前，10分前，30分前，1時間前，1日前 ．．．7日前の状態が保存され
ています．
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-9-2" class="outline-3">
<h3 id="sec-9-2"><span class="section-number-3">9.2</span> 開発ディレクトリ</h3>
<div class="outline-text-3" id="text-9-2">
<p>
<a href="file:///home/staff/suzuki/prog">file:///home/staff/suzuki/prog</a> の下の自分のログイン名のディレクトリ
</p>
</div>
</div>

<div id="outline-container-sec-9-3" class="outline-3">
<h3 id="sec-9-3"><span class="section-number-3">9.3</span> ~/progs でシンボリックリンクする</h3>
<div class="outline-text-3" id="text-9-3">
<pre class="example">
((% ln -s ~suzuki/prog/h00j000 ~/progs %))
</pre>
<ul class="org-ul">
<li>既にリンクが張れている人はなにもしなくていいです．
</li>
</ul>

<p>
すでに ~/progs というディレクトリを作ってしまった人は，以下のコマン
ドをおこなってください
</p>

<pre class="example">
((% cd ; mv progs progs.local %)) 
#今までのprogsをprogs.localという名前にする (mv は move)
</pre>

<pre class="example">
((% ln -s ~suzuki/prog/h00j000 ~/progs %)) 
# [[s-:]] の用意したディレクトリへ、~/progs というシンボリックリンクを張る. 
</pre>

<pre class="example">
((% cp -Rp progs.local progs %))
# 古い progs の内容を新しい progs へコピー する．
</pre>
</div>
</div>

<div id="outline-container-sec-9-4" class="outline-3">
<h3 id="sec-9-4"><span class="section-number-3">9.4</span> ~/progs/{Game, Trigo, Reports}</h3>
<div class="outline-text-3" id="text-9-4">
</div><div id="outline-container-sec-9-4-1" class="outline-4">
<h4 id="sec-9-4-1">サブディレクトリの作成</h4>
<div class="outline-text-4" id="text-9-4-1">
<p>
~/progsの下に三つのディレクトリを作ります．
</p>
<pre class="example">
((% cd ~/progs;  mkdir -p {Game,Trigo,Reports} %))
</pre>

<p>
作成した，三角関数をTrigoの下に移します．
</p>

<pre class="example">
((% mv Makefile *.c *.h Trigo %))
</pre>

<p>
作成したレポート (~/progs/report-1) を ~/progs/Reports/1へ移します
</p>

<pre class="example">
((% mv report-1 Reports/1 %))
</pre>
<hr  />
</div>
</div>
</div>
</div>
<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> モジュールとは</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-sec-10-1" class="outline-3">
<h3 id="sec-10-1"><span class="section-number-3">10.1</span> モジュールのイメージ</h3>
<div class="outline-text-3" id="text-10-1">
</div><div id="outline-container-sec-10-1-1" class="outline-4">
<h4 id="sec-10-1-1">関数</h4>
<div class="outline-text-4" id="text-10-1-1">
<ul class="org-ul">
<li>関数として独立したもの
</li>
<li>関数とは何？
<ul class="org-ul">
<li>名前で呼び出せること
</li>
<li>値を渡せること
</li>
<li>結果が返ってくること
</li>
</ul>
</li>
<li>独立するとはどういうこと？
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10-1-2" class="outline-4">
<h4 id="sec-10-1-2">機能</h4>
<div class="outline-text-4" id="text-10-1-2">
<ul class="org-ul">
<li>大きな仕事の中から，
独立したまとまりのいい部分的な機能を取り出したもの，
</li>
<li>使いまわしがきく
</li>
<li>インターフェイスをとおして使う
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10-2" class="outline-3">
<h3 id="sec-10-2"><span class="section-number-3">10.2</span> モジュールとは部品</h3>
<div class="outline-text-3" id="text-10-2">
</div><div id="outline-container-sec-10-2-1" class="outline-4">
<h4 id="sec-10-2-1">部品の利用</h4>
<div class="outline-text-4" id="text-10-2-1">
<ul class="org-ul">
<li>ある機能の実体
</li>
<li>その実装をしらずに，
</li>
<li>インターフェイスを守り，
</li>
<li>自分のプログラムから利用できる
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-10-2-2" class="outline-4">
<h4 id="sec-10-2-2">部品の提供</h4>
<div class="outline-text-4" id="text-10-2-2">
<ul class="org-ul">
<li>ある独立した機能を実現し，
</li>
<li>インターフェイスを守り
</li>
<li>インターフェイスのみを通して，
</li>
<li>他の人に機能を提供する
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-10-3" class="outline-3">
<h3 id="sec-10-3"><span class="section-number-3">10.3</span> Ubuntu/C言語を使ったモジュールプログラミング</h3>
<div class="outline-text-3" id="text-10-3">
</div><div id="outline-container-sec-10-3-1" class="outline-4">
<h4 id="sec-10-3-1">利用側</h4>
<div class="outline-text-4" id="text-10-3-1">
<ul class="org-ul">
<li>あるライブラリの機能（関数）を見つけ，
</li>
<li>man やヘッダファイルを見て，APIを知る
</li>
<li>ヘッダファイルをインクルードし，
インターフェイスを守っていることを，
コンパイラに検査してもらう
</li>
<li>自分のプログラムに，ライブラリの関数をリンクする
</li>
<li>プログラムをプロセスとして実行する
</li>
</ul>
</div>

<div id="outline-container-sec-10-3-1-1" class="outline-5">
<h5 id="sec-10-3-1-1">提供側</h5>
<div class="outline-text-5" id="text-10-3-1-1">
<ul class="org-ul">
<li>ヘッダファイルを作成し
</li>
<li>ヘッダファイルをインクルードし，
</li>
<li>機能を関数として実装し，
</li>
<li>ヘッダファイルのAPIを遵守する
</li>
<li>オブジェクトファイルあるいはライブラリとして提供する
</li>
</ul>
<p>
　　
</p>
<hr  />
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> ソフトウェア構成論 (昔の説明@wiki)</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-sec-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> 道具達の使い方</h3>
<div class="outline-text-3" id="text-11-1">
<p>
<a href="./c.html">C言語</a>
</p>

<p>
<a href="./compiler.html">コンパイラ</a>
</p>

<p>
<a href="./emacs.html">emacs</a> が使えるように
</p>
<ul class="org-ul">
<li>org-mode が使えると便利かも
</li>
</ul>

<p>
<a href="https://wiki.cis.iwate-u.ac.jp/svn/prog">サブバージョンのリポジトリ</a>
</p>
<ul class="org-ul">
<li><a href="./subversion.html">バージョン管理</a> できるようになりましょう
</li>
</ul>

<p>
<a href="./shell.html">シェル</a>
</p>

<p>
<a href="./make.html">make</a>
</p>

<p>
<a href="file://~suzuki/prog/">開発ディレクトリ</a>
</p>

<pre class="example">
((% cd; ln -s ~suzuki/prog/h17j15 progs %))
</pre>
</div>
</div>


<div id="outline-container-sec-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> 自前の関数を作り，利用する</h3>
<div class="outline-text-3" id="text-11-2">
</div><div id="outline-container-sec-11-2-1" class="outline-4">
<h4 id="sec-11-2-1">度が使えるsin関数を作る</h4>
<div class="outline-text-4" id="text-11-2-1">
<ul class="org-ul">
<li>sin 関数の変更拡張を行い
</li>
<li>新たな関数（ライブラリ）の提供
</li>
<li>新たな関数を使って実行プログラムを作る
</li>
</ul>
</div>

<div id="outline-container-sec-11-2-1-1" class="outline-5">
<h5 id="sec-11-2-1-1">ライブラリの sin を調べる</h5>
<div class="outline-text-5" id="text-11-2-1-1">
<p>
sin 関数の素性とは？
</p>

<pre class="example">
# include &lt;math.h&gt;
double sin(double)
</pre>
</div>
</div>

<div id="outline-container-sec-11-2-1-2" class="outline-5">
<h5 id="sec-11-2-1-2">引数を度で渡すと，sin関数値を計算する関数</h5>
<div class="outline-text-5" id="text-11-2-1-2">
</div><div id="outline-container-sec-11-2-1-2-1" class="outline-6">
<h6 id="sec-11-2-1-2-1">名前と引数の型と結果の型を決める</h6>
<div class="outline-text-6" id="text-11-2-1-2-1">
<pre class="example">
double d_sin(double)
</pre>
</div>
</div>

<div id="outline-container-sec-11-2-1-2-2" class="outline-6">
<h6 id="sec-11-2-1-2-2">この決まりごとをヘッダファイルに書いておく</h6>
<div class="outline-text-6" id="text-11-2-1-2-2">
<p>
<a href="./d_sin.h">./d_sin.h</a>
</p>
<pre class="example">
</pre>
</div>
</div>

<div id="outline-container-sec-11-2-1-2-3" class="outline-6">
<h6 id="sec-11-2-1-2-3"><a href="./d_sin.c">./d_sin.c</a> に関数の振る舞いをプログラムする</h6>
<div class="outline-text-6" id="text-11-2-1-2-3">
<p>
決まりごと
</p>

<pre class="example">
# include &lt;d_sin.h&gt; // あらかじめ決めた素性を読み込む

double d_sin(double x) // あらかじめ決めた素性を読み込む
{
  double result;

   sin関数を使った計算，
   結果をresult に代入

  return result;
}
</pre>
</div>
</div>


<div id="outline-container-sec-11-2-1-2-4" class="outline-6">
<h6 id="sec-11-2-1-2-4">d_sin.c をコンパイルしてみる</h6>
<div class="outline-text-6" id="text-11-2-1-2-4">
<p>
コンパイラが文句を言わず，
オブジェクトファイル d_sin.o が正しくできれば，
取り合えず目標達成
</p>

<ul class="org-ul">
<li>((% gcc d_sin.c %)) ?
</li>

<li>((% gcc -c d_sin.c %)) ?
</li>

<li>((% gcc -c -I . d_sin.c %))
</li>
</ul>
</div>
</div>
</div>


<div id="outline-container-sec-11-2-1-3" class="outline-5">
<h5 id="sec-11-2-1-3">角度を入力したらそのsin値を計算するプログラムを書く</h5>
<div class="outline-text-5" id="text-11-2-1-3">
</div><div id="outline-container-sec-11-2-1-3-1" class="outline-6">
<h6 id="sec-11-2-1-3-1"><a href="./calc_sin.c">./calc_sin.c</a></h6>
<div class="outline-text-6" id="text-11-2-1-3-1">
<ul class="org-ul">
<li>d_sin.h が 関数の素性
<pre class="example">
# include &lt;d_sin.h&gt;
</pre>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-2-1-3-2" class="outline-6">
<h6 id="sec-11-2-1-3-2">sin(deg_to_rad(atof(argv\[1\]))) の計算</h6>
</div>

<div id="outline-container-sec-11-2-1-3-3" class="outline-6">
<h6 id="sec-11-2-1-3-3">コンパイルして calc_d_sin.o を作る</h6>
<div class="outline-text-6" id="text-11-2-1-3-3">
<pre class="example">
((% gcc -c calc_d_sin.c %))
</pre>

<pre class="example">
((% nm calc_d_sin.o %)) 
</pre>
</div>
</div>


<div id="outline-container-sec-11-2-1-3-4" class="outline-6">
<h6 id="sec-11-2-1-3-4">d_sin.o と calc_d_sin.o （とライブラリ)をリンクして，実行プログラムを作る</h6>
<div class="outline-text-6" id="text-11-2-1-3-4">
<pre class="example">
((% gcc calc_d_sin.o d_sin.o -lm -o calc_d_sin %))
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-11-2-1-4" class="outline-5">
<h5 id="sec-11-2-1-4">make</h5>
<div class="outline-text-5" id="text-11-2-1-4">
<p>
どうやって目的のプログラムを作るのかを，
段階的に記述する
</p>

<p>
<a href="https://lagendra.s.kanazawa-u.ac.jp/ogurisu/manuals/make-intro/index.html">https://lagendra.s.kanazawa-u.ac.jp/ogurisu/manuals/make-intro/index.html</a>
</p>
</div>

<div id="outline-container-sec-11-2-1-4-1" class="outline-6">
<h6 id="sec-11-2-1-4-1">実行プログラムを作成するまでにおこなったコマンド</h6>
<div class="outline-text-6" id="text-11-2-1-4-1">
<ul class="org-ul">
<li>d_sin.h を設計し，d_sin.c に実装を記述
</li>
<li>: ((% gcc -c -I . d_sin.c %))
</li>
<li>d_sin.o ができる
</li>

<li>d_sin.h に従って，calc_d_sin.c を記述
</li>
<li>: ((% cc -c -I . calc_d_sin.c %))
</li>
<li>calc_d_sin.o ができる
</li>

<li>d_sin.o とcalc_d_sin.o を結合し，実行プログラムを作成
</li>
<li>: ((% cc -o calc_d_sin calc_d_sin.o d_sin.o -lm %))
</li>
<li>実行プログラム calc_d_sin ができる
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11-2-1-4-2" class="outline-6">
<h6 id="sec-11-2-1-4-2">Makefile にこれらを記述</h6>
<div class="outline-text-6" id="text-11-2-1-4-2">
<p>
<a href="file:///home/staff/suzuki/.Makefile">file:///home/staff/suzuki/.Makefile</a>
</p>

<pre class="example">
all: calc_d_sin
        echo 'all done'
        touch all
</pre>

<ul class="org-ul">
<li>allファイルを作るには，
<ul class="org-ul">
<li>まず calc_d_sin をつくる
</li>
<li>その後に，((% echo 'all done' %)) コマンドを実行し，
</li>
<li>((% touch all %)) で，allファイルができる
</li>
</ul>
<p>
コマンドが実行されるのは以下の時
</p>
<ul class="org-ul">
<li>all がないか，
</li>
<li>callc_d_sin ファイルより更新日付が古いか
</li>
</ul>
</li>
</ul>

<pre class="example">
d_sin.o: d_sin.h d_sin.c
        gcc -c -I . d_sin.c
</pre>

<pre class="example">
calc_d_sin.o: d_sin.h calc_d_sin.c
        gcc -c -I . calc_d_sin.c
</pre>

<pre class="example">
calc_d_sin: calc_d_sin.o d_sin.o
        gcc -o calc_d_sin calc_d_sin.o d_sin.o -lm 
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-11-2-1-5" class="outline-5">
<h5 id="sec-11-2-1-5">バージョン管理</h5>
<div class="outline-text-5" id="text-11-2-1-5">
<p>
リポジトリの中に自分のディレクトリを作る
</p>
<pre class="example">
((% svn mkdir https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/hXXjYYY %))
</pre>

<p>
作業用ディレクトリ（ワーキングコピー）にチェックアウトする
</p>

<pre class="example">
((% cd; ln -s ~suzuki/prog/hXXjYYY progs %))
((% cd progs %))
((% svn co https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/hXXjYYY . %))
</pre>

<p>
(svn) 管理情報を見る
</p>

<pre class="example">
((% svn info %))
</pre>

<p>
READMEというファイルを作成し，何か情報を書く
</p>
<pre class="example">
((% emacs README %))
</pre>

<p>
READMEの履歴管理を始める
</p>
<pre class="example">
((% svn add README %))
</pre>

<p>
ワーキングコピーの状態を確かめる
</p>
<pre class="example">
((% svn st %))
</pre>

<p>
ワーキングコピーをリポジトリに反映させる（コミット）
</p>
<pre class="example">
((% svn ci -m 'hXXjYY はじめました' %))
</pre>

<p>
ログを見る
</p>
<pre class="example">
((% svn log %))
</pre>
<hr  />
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> ソフトウェア構成論の受講の準備</h2>
<div class="outline-text-2" id="text-12">
</div><div id="outline-container-sec-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> 開発ディレクトリ</h3>
<div class="outline-text-3" id="text-12-1">
<p>
~/progs
~/progs/{Reports,Game,Card_Display}
</p>
</div>
</div>

<div id="outline-container-sec-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> Wiki</h3>
<div class="outline-text-3" id="text-12-2">
<ul class="org-ul">
<li>htp://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi をブックマーク
</li>
<li>{cis prog} Google検索
</li>
</ul>

<p>
Wikiの見方
</p>
</div>
</div>

<div id="outline-container-sec-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> C言語</h3>
</div>

<div id="outline-container-sec-12-4" class="outline-3">
<h3 id="sec-12-4"><span class="section-number-3">12.4</span> 開発環境</h3>
<div class="outline-text-3" id="text-12-4">
</div><div id="outline-container-sec-12-4-1" class="outline-4">
<h4 id="sec-12-4-1">Emacs</h4>
</div>
<div id="outline-container-sec-12-4-2" class="outline-4">
<h4 id="sec-12-4-2">make</h4>
</div>
<div id="outline-container-sec-12-4-3" class="outline-4">
<h4 id="sec-12-4-3">GCC</h4>
</div>
<div id="outline-container-sec-12-4-4" class="outline-4">
<h4 id="sec-12-4-4">シェルとスクリプト</h4>
</div>
<div id="outline-container-sec-12-4-5" class="outline-4">
<h4 id="sec-12-4-5"></h4>
</div>
</div>
<div id="outline-container-sec-12-5" class="outline-3">
<h3 id="sec-12-5"><span class="section-number-3">12.5</span> 連絡方法</h3>
<div class="outline-text-3" id="text-12-5">
<ul class="org-ul">
<li>suzuki@cis.iwate-u.ac.jp
</li>
<li>6
</li>
</ul>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13"><span class="section-number-2">13</span> shell</h2>
<div class="outline-text-2" id="text-13">
</div><div id="outline-container-sec-13-1" class="outline-3">
<h3 id="sec-13-1"><span class="section-number-3">13.1</span> ディレクトリ</h3>
<div class="outline-text-3" id="text-13-1">
<pre class="example">
((% cd %))
((% cd ~/ %))
((% cd ~suzuki/ %))
</pre>

<pre class="example">
((% mkdir hoge/hage %))
((% ls -R %))
</pre>
</div>
</div>

<div id="outline-container-sec-13-2" class="outline-3">
<h3 id="sec-13-2"><span class="section-number-3">13.2</span> ファイル</h3>
<div class="outline-text-3" id="text-13-2">
<pre class="example">
((% mv a b %))
((% rm a %))
((% touch a %))
</pre>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14"><span class="section-number-2">14</span> ソフトウェア構成論 svnあれこれ</h2>
<div class="outline-text-2" id="text-14">
</div><div id="outline-container-sec-14-1" class="outline-3">
<h3 id="sec-14-1"><span class="section-number-3">14.1</span> h22j018</h3>
<div class="outline-text-3" id="text-14-1">
<p>
((% cd ~h22j018/progs %))
((% svn info %))
</p>
<ul class="org-ul">
<li>URL: <a href="https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018">https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018</a>
</li>
</ul>
<p>
((% svn ls %))
</p>
<ul class="org-ul">
<li>README
</li>
</ul>
<p>
((% cd Game; svn info %))
</p>
<ul class="org-ul">
<li>URL: <a href="https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018">https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018</a>
      ~/progs と同じ場所をさしている

<p>
多分，~/progs と ~/progs/Gameの二ヶ所で，
((% svn co //<a href="https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018">https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j018</a>
. %))
</p>
</li>
</ul>
</div>

<div id="outline-container-sec-14-1-1" class="outline-4">
<h4 id="sec-14-1-1">対策</h4>
<div class="outline-text-4" id="text-14-1-1">
<pre class="example">
((% cd ~/progs/Game; rm -rf .svn Card/.svn %))
((% cd ~/progs; svn add Game %))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-14-2" class="outline-3">
<h3 id="sec-14-2"><span class="section-number-3">14.2</span> h22j016</h3>
<div class="outline-text-3" id="text-14-2">
<pre class="example">
suzuki@:esut118:~h22j016/progs[119] &gt; svn st
?       report-1
?       h22j016
R     C Game
      &gt;   local delete, incoming edit upon update
?       Game/Deck
A       Game/Interface
?       Game/Interface/card.h
A       Game/Module
R       Game/Card
?       Game/Card/test_compare
?       Game/Card/Card.org
R       Game/Card/card.h
D       Game/Card/test_compare.c
R       Game/Card/compare.c
R       Game/Card/test_card
R       Game/Card/test_card.c
R       Game/Card/card.c
R       Game/Card/test_print
R       Game/Card/test_print.c
R       Game/Card/Makefile
R       Game/Card/print.c
A       Game/Makefile
</pre>
</div>

<div id="outline-container-sec-14-2-1" class="outline-4">
<h4 id="sec-14-2-1">症状</h4>
<div class="outline-text-4" id="text-14-2-1">
<p>
リポジトリのGameに変更があったのに，
((% svn up %)) せずに，Game の下に，
Card, Interface, Module, Makefile を ((% svn add %)) した。
</p>
</div>
</div>


<div id="outline-container-sec-14-2-2" class="outline-4">
<h4 id="sec-14-2-2">対策</h4>
<div class="outline-text-4" id="text-14-2-2">
<p>
実行する時は，suzuki が立ち会いますので，声をかけてください。
</p>

<pre class="example">
((% cd ~/progs; svn resolved Game %))
((% svn add --force Card/test_compare.c %))
((% svn add Card/Card.org %))
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-14-3" class="outline-3">
<h3 id="sec-14-3"><span class="section-number-3">14.3</span> h22j086</h3>
<div class="outline-text-3" id="text-14-3">
<pre class="example">
suzuki@:esut118:~h22j086/progs[123] &gt; ls
Game/  Trigo/  game/  report-1/
suzuki@:esut118:~h22j086/progs[124] &gt; svn st
?       report-1
?       game/interface
?       game/module
?       game/Deck
?       game/Card/Card.txt
!       README
suzuki@:esut118:~h22j086/progs[125] &gt; svn ls
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[127] &gt; svn info
URL: https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j086
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[132] &gt; svn ls
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[133] &gt; svn ls https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/h22j086
Game/
README
Trigo/
game/
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[135] &gt; sudo -u h22j086 svn up
[sudo] password for suzuki: 
認証領域: &lt;https://wiki.cis.iwate-u.ac.jp:80&gt; Subversion repository
'h22j086' のパスワード: 
認証領域: &lt;https://wiki.cis.iwate-u.ac.jp:80&gt; Subversion repository
ユーザ名: suzuki
'suzuki' のパスワード: hogehogehogehoge
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[136] &gt; svn ls
Game/
README
Trigo/
game/
suzuki@:esut118:~h22j086/progs[137] &gt; svn st
?       report-1
?       game/interface
?       game/module
?       game/Deck
?       game/Card/Card.txt
</pre>

<pre class="example">
suzuki@:esut118:~h22j086/progs[138] &gt; 
</pre>
</div>

<div id="outline-container-sec-14-3-1" class="outline-4">
<h4 id="sec-14-3-1">症状</h4>
<div class="outline-text-4" id="text-14-3-1">
<p>
リポジトリとワーキングコピーがずれている
</p>
</div>
</div>

<div id="outline-container-sec-14-3-2" class="outline-4">
<h4 id="sec-14-3-2">対策</h4>
<div class="outline-text-4" id="text-14-3-2">
<p>
まず ((% svn up %)) しました。
あとは，不必要なgame 下を消して，
</p>

<pre class="example">
((% svn add report-1 %))
((% svn ci %))
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-14-4" class="outline-3">
<h3 id="sec-14-4"><span class="section-number-3">14.4</span> h22j124</h3>
<div class="outline-text-3" id="text-14-4">
<p>
~h22j12/progs を emacs の svn-status で見ると下記のようになっていま
す。
</p>

<pre class="example">
svn status for directory /home/h22j/h22j124/progs/
0 file(s) marked

      1820 1818 h22j124     . -&gt; /home/staff/suzuki/prog/h22j124
  ?             ?           %
      1820 1818 h22j124     Game
      1820 1818 h22j124       Card
  ?             ?               Card.txt
      1820 1818 h22j124         Makefile
      1820 1710 h22j124         card.c
      1820 1710 h22j124         card.h
      1820 1710 h22j124         compare.c
      1820 1710 h22j124         print.c
      1820 1710 h22j124         test_card.c
  ?             ?               test_card
  ?             ?               test_compare.c
  ?             ?               test_compare
      1820 1710 h22j124         test_print.c
      1820 1710 h22j124         test_print
  R   1830 1830 h22j124       Deck (switched)
  R   1830 1830 h22j124         Game
  R   1830 1830 h22j124           Card
  D   1830 1830 h22j124             Makefile
  D   1830 1830 h22j124             card.c
  D   1830 1830 h22j124             card.h
  D   1830 1830 h22j124             compare.c
  D   1830 1830 h22j124             print.c
  D   1830 1830 h22j124             test_card.c
  D   1830 1830 h22j124             test_print.c
  D   1830 1830 h22j124             test_print
  R   1830 1830 h22j124           Interface
  D   1830 1830 h22j124             card.h
  D   1830 1830 h22j124           Makefile
  R   1830 1830 h22j124           Module
  D   1830 1830 h22j124         README
  R   1830 1830 h22j124         Trigo
  D   1830 1830 h22j124           Makefile
  D   1830 1830 h22j124           calc_d_sin.c
  D   1830 1830 h22j124           d_cos.c
  D   1830 1830 h22j124           d_cos.h
  D   1830 1830 h22j124           d_sin.c
  D   1830 1830 h22j124           d_sin.h
  D   1830 1830 h22j124           dsin.c
  R   1830 1830 h22j124           report-1
  D   1830 1830 h22j124             Makefile
  D   1830 1830 h22j124             README
  D   1830 1830 h22j124             calc.c
  D   1830 1830 h22j124             calc
  D   1830 1830 h22j124             d_trigo.c
  D   1830 1830 h22j124             d_trigo.h
      1820 1710 h22j124       Interface
      1820 1710 h22j124         card.h
      1820 1710 h22j124       Makefile
      1820 1710 h22j124       Module
      1820 1705 h22j124     README
      1820 1710 h22j124     Trigo
      1820 1710 h22j124       Makefile
      1820 1710 h22j124       calc_d_sin.c
      1820 1710 h22j124       d_cos.c
      1820 1710 h22j124       d_cos.h
      1820 1710 h22j124       d_sin.c
      1820 1710 h22j124       d_sin.h
      1820 1710 h22j124       dsin.c
      1820 1710 h22j124       report-1
      1820 1710 h22j124         Makefile
      1820 1710 h22j124         README
      1820 1710 h22j124         calc.c
      1820 1710 h22j124         calc
      1820 1710 h22j124         d_trigo.c
      1820 1710 h22j124         d_trigo.h
  ?             ?           h22j124 -&gt; /home/staff/suzuki/prog/h22j124
</pre>

<p>
　
   これをみるとprogs/Game/Deckの下にGameをチェックアウトしたもようです。
   Deck/{deck.h, deck.c}は残念ながら見当たりません。
</p>
</div>

<div id="outline-container-sec-14-4-1" class="outline-4">
<h4 id="sec-14-4-1">対策</h4>
<div class="outline-text-4" id="text-14-4-1">
<pre class="example">
((% cd ~/progs/Game; rm -rf Deck %))
((% svn add Card/Card.txt Card/test_compare.c %))
</pre>
<hr  />
</div>
</div>
</div>
</div>
<div id="outline-container-sec-15" class="outline-2">
<h2 id="sec-15"><span class="section-number-2">15</span> subversion 6/4</h2>
<div class="outline-text-2" id="text-15">
</div><div id="outline-container-sec-15-1" class="outline-3">
<h3 id="sec-15-1"><span class="section-number-3">15.1</span> コミットの時にviが動いたとき</h3>
<div class="outline-text-3" id="text-15-1">
<ul class="org-ul">
<li>i で入力モード、
</li>
<li>入力後エスケープで終了
</li>
<li>:wq で書き込みviを終了する
</li>
</ul>

<p>
emacsを使いたい人は、~/.bashrc 中に
</p>

<pre class="example">
export SVN_EDITOR=emacs
</pre>
</div>
</div>


<div id="outline-container-sec-15-2" class="outline-3">
<h3 id="sec-15-2"><span class="section-number-3">15.2</span> 認証設定の確認</h3>
<div class="outline-text-3" id="text-15-2">
<pre class="example">
((% svn ls https://wiki.cis.iwate-u.ac.jp/svn/prog %))
</pre>

<p>
を実行して，gnome-keyring のエラーが出る人は，  
</p>

<p>
~/.gnome2/keyrings/login.keyring を消して，もう一度試してみてくださ
い．
</p>

<pre class="example">
((% rm ~/.gnome2/keyrings/login.keyring %))
</pre>
</div>
</div>


<div id="outline-container-sec-15-3" class="outline-3">
<h3 id="sec-15-3"><span class="section-number-3">15.3</span> バージョン管理コマンド</h3>
<div class="outline-text-3" id="text-15-3">
<p>
環境変数の設定
</p>

<pre class="example">
export SVN_EDITOR=emacs
</pre>

<p>
<a href="file:///home/staff/suzuki/.bashrc">file:///home/staff/suzuki/.bashrc</a>  にも下行を追加
</p>

<pre class="example">
export SVN_EDITOR=emacs
</pre>


<p>
リポジトリの中に自分のディレクトリを作る
</p>
<pre class="example">
((% svn mkdir https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/hXXjYYY %))
</pre>

<p>
作業用ディレクトリ（ワーキングコピー）にチェックアウトする
</p>

<pre class="example">
((% cd; ln -s ~suzuki/prog/hXXjYYY progs %))
((% cd progs %))
((% svn co https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/hXXjYYY . %))
</pre>

<p>
(svn) 管理情報を見る
</p>

<pre class="example">
((% svn info %))
</pre>

<p>
READMEというファイルを作成し，何か情報を書く
</p>
<pre class="example">
((% emacs README %))
</pre>

<p>
READMEの履歴管理を始める
</p>
<pre class="example">
((% svn add README %))
</pre>

<p>
ワーキングコピーの状態を確かめる
</p>
<pre class="example">
((% svn st %))
</pre>

<p>
ワーキングコピーをリポジトリに反映させる（コミット）
</p>
<pre class="example">
((% svn ci -m 'hXXjYY はじめました' %))
</pre>

<p>
ログを見る
</p>
<pre class="example">
((% svn log %))
</pre>
</div>
</div>


<div id="outline-container-sec-15-4" class="outline-3">
<h3 id="sec-15-4"><span class="section-number-3">15.4</span> 学生さんの感想とか</h3>
<div class="outline-text-3" id="text-15-4">
<p>
<a href="https://spws01.cis.iwate-u.ac.jp/~wiki/net-note-05.cgi?%E5%98%86%E3%81%8D%E3%81%AE%E6%A8%B9">嘆きの木</a>
</p>
</div>
</div>




<div id="outline-container-sec-15-5" class="outline-3">
<h3 id="sec-15-5"><span class="section-number-3">15.5</span> Cardモジュールをリポジトリにコミットする</h3>
<div class="outline-text-3" id="text-15-5">
<pre class="example">
((% cd ~/progs/ %))
</pre>

<pre class="example">
((% svn co https://wiki.cis.iwate-u.ac.jp/svn/prog/2012/hxxjyyy . %))
</pre>

<pre class="example">
((% svn info %))
</pre>


<p>
Cardディレクトリ下をキレイにする
</p>

<pre class="example">
((% cd ~/progs/Game/Card; make clean %))
</pre>

<p>
Card/ のバージョン管理を始める
</p>

<pre class="example">
((% cd ~/progs/Game %))
((% svn add Card %))  # Card/下のファイルを全て登録する
((% svn st %)) # 変更状態を確かめる
</pre>

<p>
この状態では Card/ (ワーキングコピー）だけが存在し，
リポジトリ上にはまだ Card/ は存在していません．
</p>

<p>
ワーキングコピーをリポジトリへ
</p>
<pre class="example">
((% svn ci -m 'カードモジュール，始めました．'))
</pre>
<hr  />
</div>
</div>
</div>
<div id="outline-container-sec-16" class="outline-2">
<h2 id="sec-16"><span class="section-number-2">16</span> 「VC（バージョンコントロール）パッケージの基礎」(菅原泰樹) — ありえるえりあ</h2>
<div class="outline-text-2" id="text-16">
<dl class="org-dl">
<dt> 出展 </dt><dd><a href="https://dev.ariel-networks.com/articles/emacs/part7/">https://dev.ariel-networks.com/articles/emacs/part7/</a>
</dd>
</dl>
</div>

<div id="outline-container-sec-16-1" class="outline-3">
<h3 id="sec-16-1"><span class="section-number-3">16.1</span> VCとは</h3>
<div class="outline-text-3" id="text-16-1">
<p>
VCはEmacs上で各種バージョン管理システムを統合的に扱うパッケージです．
</p>

<p>
RCS, CVS, Subversion, Git, Mercurial, Bazaar, Gnu-Archに標準で対応しています．
</p>
</div>
</div>


<div id="outline-container-sec-16-2" class="outline-3">
<h3 id="sec-16-2"><span class="section-number-3">16.2</span> バージョン管理システム</h3>
<div class="outline-text-3" id="text-16-2">
<p>
Wikipedia <a href="https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0">https://ja.wikipedia.org/wiki/%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%AE%A1%E7%90%86%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0</a>
</p>

<ul class="org-ul">
<li>ソースコードの履歴の管理
</li>
<li>他人とのソースコードの共有
</li>
<li>他人の変更と自分の変更のマージ・衝突の検出
</li>
</ul>

<p>
複数人で何かを開発するときには絶対に必要なシステムですし，一人で開
発するときにも，履歴や差分の確認等に大活躍です．
</p>

<p>
代表的なバージョン管理システムには以下のものがあります．
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">CVS</td>
<td class="left"><a href="https://www.cvshome.org/">https://www.cvshome.org/</a></td>
</tr>

<tr>
<td class="left">Subversion</td>
<td class="left"><a href="https://subversion.tigris.org/">https://subversion.tigris.org/</a></td>
</tr>

<tr>
<td class="left">Git</td>
<td class="left"><a href="https://git-scm.com/">https://git-scm.com/</a></td>
</tr>

<tr>
<td class="left">Mercurial</td>
<td class="left"><a href="https://www.selenic.com/mercurial/">https://www.selenic.com/mercurial/</a></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-16-3" class="outline-3">
<h3 id="sec-16-3"><span class="section-number-3">16.3</span> 代表的なVCを操作するコマンド</h3>
<div class="outline-text-3" id="text-16-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />

<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">キーバインド</td>
<td class="left">コマンド</td>
<td class="left">説明</td>
<td class="left">Subversionのコマンド</td>
</tr>

<tr>
<td class="left">C-x v =</td>
<td class="left">vc-diff</td>
<td class="left">差分を表示</td>
<td class="left">diff</td>
</tr>

<tr>
<td class="left">C-x v l</td>
<td class="left">vc-print-log</td>
<td class="left">履歴を表示</td>
<td class="left">log</td>
</tr>

<tr>
<td class="left">C-x v g</td>
<td class="left">vc-annotate</td>
<td class="left">注釈を表示</td>
<td class="left">blame</td>
</tr>

<tr>
<td class="left">C-x v ~</td>
<td class="left">vc-revision-other-window</td>
<td class="left">過去のバージョンを表示</td>
<td class="left">cat</td>
</tr>

<tr>
<td class="left">C-x v +</td>
<td class="left">vc-update</td>
<td class="left">更新</td>
<td class="left">update</td>
</tr>

<tr>
<td class="left">C-x v v</td>
<td class="left">vc-next-action</td>
<td class="left">コミット</td>
<td class="left">commit</td>
</tr>

<tr>
<td class="left">C-x v i</td>
<td class="left">vc-register</td>
<td class="left">ファイルの追加</td>
<td class="left">add</td>
</tr>

<tr>
<td class="left">C-x v u</td>
<td class="left">vc-revert</td>
<td class="left">修正の破棄</td>
<td class="left">revert</td>
</tr>

<tr>
<td class="left">C-x v d</td>
<td class="left">vc-dir</td>
<td class="left">状態の表示</td>
<td class="left">status</td>
</tr>

<tr>
<td class="left">&#xa0;</td>
<td class="left">ediff-revision</td>
<td class="left">Ediffで差分を表示</td>
<td class="left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-16-4" class="outline-3">
<h3 id="sec-16-4"><span class="section-number-3">16.4</span> 差分の表示</h3>
<div class="outline-text-3" id="text-16-4">
<p>
差分を表示するにはC-x v = (vc-diff)を入力します．普通は作業コピーと
HEADとの差分です．svn diffなどと同じですね．リビジョンを選んで差分
を表示するにはC-u C-x v =としてからリビジョンを入力するか，後で説明
する履歴表示機能を使います．C-x v =を入力すると以下のようにWindowが
分割して差分が表示されます．
</p>
</div>
</div>

<div id="outline-container-sec-16-5" class="outline-3">
<h3 id="sec-16-5"><span class="section-number-3">16.5</span> 注釈の表示</h3>
<div class="outline-text-3" id="text-16-5">
<p>
注釈を表示するにはC-x v g (vc-annotate)を入力します．バージョン管理
システムでの注釈とはソースの各行を最後に更新した人とそのリビジョン
を表示する機能のことです．リビジョンを選んで注釈を表示するにはC-u
C-x v gとしてからリビジョンを入力するか，後で説明する履歴表示機能を
使います．C-x v gを入力すると以下のようにWindowが分割して注釈が表示
されます
</p>
</div>
</div>

<div id="outline-container-sec-16-6" class="outline-3">
<h3 id="sec-16-6"><span class="section-number-3">16.6</span> 履歴の表示</h3>
<div class="outline-text-3" id="text-16-6">
<p>
履歴を表示するにはC-x v l (vc-print-log)を入力します．
</p>

<p>
履歴バッファでは差分の表示や該当リビジョンの取り出し等が行なえます．
</p>

<p>
履歴バッファでの操作は自分で調べてください。
</p>
</div>
</div>

<div id="outline-container-sec-16-7" class="outline-3">
<h3 id="sec-16-7"><span class="section-number-3">16.7</span> 更新系の操作</h3>
<div class="outline-text-3" id="text-16-7">
<p>
バージョン管理システムからファイルを更新するにはC-x v + (vc-update)
とします．
</p>

<p>
修正してコミットするときはC-x v v (vc-next-action)です．コミットロ
グを入力するバッファが表示されるので，ログを入力したらC-c C-c
(log-edit-done)でコミットを完了させる．
</p>

<p>
ファイルを追加してそれを通知するときもC-x v vです．もう一度C-x v v
すればコミットされます。
</p>

<p>
next-actionと言うだけあってコミットだけではなく次にやりたい事をそれ
となく察して実行してくます。
</p>

<p>
修正を破棄するにはC-x v u (vc-revert)を使います．
</p>
</div>
</div>


<div id="outline-container-sec-16-8" class="outline-3">
<h3 id="sec-16-8"><span class="section-number-3">16.8</span> 衝突の解決</h3>
<div class="outline-text-3" id="text-16-8">
<p>
更新をかけたときにコンフリクトが起きている場合，Emacsは自動的に
smerge-modeを実行してくれます．コンフリクトが起きているファイルを開
いたときに&lt;&lt;&lt;&lt;&lt;&lt;&lt;といった箇所に色が付いています
</p>
<hr  />
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: suzuki@cis.iwate-u.ac.jp</p>
<p class="date">Created: 2016-10-25 火 10:05</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="https://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
