<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
<!-- 2016-09-25 日 12:23 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>ソフトウェア構成論 ポーカーゲームの開発</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="masayuki suzuki@cis.iwate-u.ac.jp" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://nat054.ddo.jp/~masayuki/org-html-theme/styles/sos/css/sos.css">
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="http://nat054.ddo.jp/~masayuki/org-html-theme/styles/sos/js/hideshow.js"></script>
<script type="text/javascript" src="http://nat054.ddo.jp/~masayuki/org-html-theme/styles/sos/js/sos.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">ソフトウェア構成論 ポーカーゲームの開発</h1>
<div id="table-of-contents">
<h2>&#30446;&#27425;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">Pokerゲーム開発の始まり</a>
<ul>
<li><a href="#orgheadline2">はじまり</a>
<ul>
<li><a href="#orgheadline3"><span class="done Done">Done</span> ポーカーゲーム作りの始まり</a>
<ul>
<li><a href="#orgheadline4">カードモジュールつくってよ (@カードモジュールつくってよ)</a></li>
<li><a href="#orgheadline5">講義で考えているポーカーゲーム</a></li>
<li><a href="#orgheadline6">ゲーム説明とモジュールわけ</a></li>
<li><a href="#orgheadline7">ゲーム説明の分析 (課題)</a></li>
<li><a href="#orgheadline8">モジュール分け</a></li>
</ul>
</li>
<li><a href="#orgheadline11">テストの意味</a>
<ul>
<li><a href="#orgheadline9">「まずテストを書く」こと</a></li>
<li><a href="#orgheadline10">フィードバック</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline13">Card モジュールの開発</a>
<ul>
<li><a href="#orgheadline12">Cardモジュール</a></li>
</ul>
</li>
<li><a href="#orgheadline75">Deck モジュールの開発</a>
<ul>
<li><a href="#orgheadline17">山について考える</a>
<ul>
<li><a href="#orgheadline14">山の機能</a>
<ul>
<li><a href="#orgheadline15">ゲームの説明から山に関する部分を取り出す</a></li>
<li><a href="#orgheadline16">山モジュールの機能</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline18">テスト駆動開発の一サイクルのテンプレート</a>
<ul>
<li><a href="#orgheadline23">機能の設計</a>
<ul>
<li><a href="#orgheadline22">インタフェースの設計</a>
<ul>
<li><a href="#orgheadline19">インタフェースを考える</a></li>
<li><a href="#orgheadline20">テスト test_&#x2026; () を書く</a></li>
<li><a href="#orgheadline21">test/test_deck.o を作る (test/Makefile)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline30">機能の実装</a>
<ul>
<li><a href="#orgheadline29">deck_new，deck_size の実装</a>
<ul>
<li><a href="#orgheadline24">インタフェースの確定 (src/deck.h)</a></li>
<li><a href="#orgheadline25">Deck を作る (src/deck.c)</a></li>
<li><a href="#orgheadline26">deck_new と deck_size を作る (src/deck.c)</a></li>
<li><a href="#orgheadline27">deck_new.o, deck_size.o を作る (src/Makefile)</a></li>
<li><a href="#orgheadline28">libdeck.a を作る (src/Makefile)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline34">機能テスト</a>
<ul>
<li><a href="#orgheadline33">テスト</a>
<ul>
<li><a href="#orgheadline31">テスト test_deck.so のビルド</a></li>
<li><a href="#orgheadline32">テストの実行とデバッグ</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline35">山のテスト駆動開発</a>
<ul>
<li><a href="#orgheadline36">開発ディレクトリ</a></li>
<li><a href="#orgheadline37">開発リポジトリ</a></li>
<li><a href="#orgheadline38">card モジュールを利用するための決まり</a></li>
<li><a href="#orgheadline39">山 (Deck) の機能の設計・実装・テスト</a>
<ul>
<li><a href="#orgheadline41">インタフェースの設計</a>
<ul>
<li><a href="#orgheadline40">インタフェースを考える</a></li>
</ul>
</li>
<li><a href="#orgheadline42">テスト test_deck_new() を書く</a>
<ul>
<li><a href="#orgheadline43">test/test_deck.o を作る</a></li>
</ul>
</li>
<li><a href="#orgheadline50">deck_new，deck_size の実装</a>
<ul>
<li><a href="#orgheadline44">インタフェースの確定 (src/deck.h)</a></li>
<li><a href="#orgheadline45">Deck を作る (src/deck.c)</a></li>
<li><a href="#orgheadline46"><span class="todo Todo">Todo</span> new と size を作る (src/deck.c)</a></li>
<li><a href="#orgheadline48"><span class="todo Todo">Todo</span> deck.o を作る (src/deck.o)</a>
<ul>
<li><a href="#orgheadline47"><span class="todo Todo">Todo</span> deck/src/Makefile の変更</a></li>
</ul>
</li>
<li><a href="#orgheadline49"><span class="todo Todo">Todo</span> libdeck.a を作る</a></li>
</ul>
</li>
<li><a href="#orgheadline53"><span class="todo Todo">Todo</span> テスト</a>
<ul>
<li><a href="#orgheadline51"><span class="todo Todo">Todo</span> テスト test_deck.so のビルド</a></li>
<li><a href="#orgheadline52"><span class="todo Todo">Todo</span> テストの実行とデバッグ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline54"><span class="todo Todo">Todo</span> 山から引く機能の設計・実装・テスト</a>
<ul>
<li>
<ul>
<li><a href="#orgheadline55">インタフェースの設計</a></li>
<li><a href="#orgheadline56">テスト</a></li>
</ul>
</li>
<li><a href="#orgheadline57">deck_draw をテストする:</a></li>
<li><a href="#orgheadline58">deck.h への追加変更</a></li>
<li><a href="#orgheadline59">deck.c への追加変更</a></li>
<li><a href="#orgheadline60">deck.o の作成</a></li>
<li><a href="#orgheadline61">libdeck.a の作成</a></li>
<li><a href="#orgheadline62">test_deck.so の作成</a></li>
<li><a href="#orgheadline63">test</a></li>
</ul>
</li>
<li><a href="#orgheadline64"><span class="todo Todo">Todo</span> カードを捨てる (test_deck.c#test_discard)</a></li>
<li><a href="#orgheadline72"><span class="todo Todo">Todo</span> 山の再構成 (deck_renew)</a>
<ul>
<li><a href="#orgheadline65">機能</a></li>
<li><a href="#orgheadline66">テストする</a></li>
<li><a href="#orgheadline67">renewの実装 (src/deck.c#renew)</a></li>
<li><a href="#orgheadline68">deck.o の作成</a></li>
<li><a href="#orgheadline69">libdeck.a の作成</a></li>
<li><a href="#orgheadline70">test_deck.so の作成</a></li>
<li><a href="#orgheadline71">test</a></li>
</ul>
</li>
<li><a href="#orgheadline73"><span class="todo Todo">Todo</span> シャッフル</a></li>
<li><a href="#orgheadline74">山を印刷</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline148">Hand モジュールの開発</a>
<ul>
<li><a href="#orgheadline97">手札について考える</a>
<ul>
<li><a href="#orgheadline76">手札の機能</a>
<ul>
<li><a href="#orgheadline77">ゲームの説明から手札に関する部分を取り出す</a></li>
<li><a href="#orgheadline78">手札モジュールの機能</a></li>
</ul>
</li>
<li><a href="#orgheadline96">機能の設計</a>
<ul>
<li><a href="#orgheadline79">機能の名前</a>
<ul>
<li><a href="#orgheadline80">手札を作ることに関する機能達</a></li>
<li><a href="#orgheadline81">手札に一枚加える/引く機能達</a></li>
<li><a href="#orgheadline82">手札の全カードを扱う機能達</a></li>
<li><a href="#orgheadline83">役に関する機能達</a></li>
</ul>
</li>
<li><a href="#orgheadline84">インタフェースを考える (deckと同じ)</a></li>
<li><a href="#orgheadline85">機能のインタフェース</a>
<ul>
<li><a href="#orgheadline86">手札</a></li>
<li><a href="#orgheadline87">hand_new</a></li>
<li><a href="#orgheadline88">hand_size</a></li>
<li><a href="#orgheadline89">hand_add</a></li>
<li><a href="#orgheadline90">hand_draw</a></li>
<li><a href="#orgheadline91">hand_sort</a></li>
<li><a href="#orgheadline92">hand_to_string</a></li>
<li><a href="#orgheadline93">hand_calc</a></li>
<li><a href="#orgheadline94">PokerHand (物)</a></li>
<li><a href="#orgheadline95">poker_hand_to_string</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline103">開発の決まり (deckとほぼ同じ)</a>
<ul>
<li><a href="#orgheadline98">開発ディレクトリ</a></li>
<li><a href="#orgheadline99">開発リポジトリ</a></li>
<li><a href="#orgheadline100">他のモジュールを利用するための決まり</a></li>
<li><a href="#orgheadline101">Makefileの準備</a></li>
<li><a href="#orgheadline102">テスト駆動開発の一サイクルのテンプレート</a></li>
</ul>
</li>
<li><a href="#orgheadline104">手札のテスト駆動開発</a></li>
<li><a href="#orgheadline147">作成された手札モジュールの解説</a>
<ul>
<li><a href="#orgheadline113">src/hand.h</a>
<ul>
<li><a href="#orgheadline105">一回だけしか，include できなくする</a></li>
<li><a href="#orgheadline106">依存するモジュールのインタフェースを読む</a></li>
<li><a href="#orgheadline107">hand 型の定義</a></li>
<li><a href="#orgheadline108">手札の作成と状態を知る機能</a></li>
<li><a href="#orgheadline109">手札の出し入れ</a></li>
<li><a href="#orgheadline110">ソート</a></li>
<li><a href="#orgheadline111">手札の表示（用文字列の生成）</a></li>
<li><a href="#orgheadline112">役に関する定義</a></li>
</ul>
</li>
<li><a href="#orgheadline121">test_hand.c</a>
<ul>
<li><a href="#orgheadline114">test_hand header</a></li>
<li><a href="#orgheadline115">手札の生成のテスト</a></li>
<li><a href="#orgheadline116">手札へのカードの追加</a></li>
<li><a href="#orgheadline117">手札の no 番目のカードのテスト</a></li>
<li><a href="#orgheadline118">手札から1枚引く</a></li>
<li><a href="#orgheadline119">手札のソート</a></li>
<li><a href="#orgheadline120">手札の文字列化のテスト</a></li>
</ul>
</li>
<li><a href="#orgheadline130">hand/src/hand.c</a>
<ul>
<li><a href="#orgheadline122">Cの標準ラブラリを使う</a></li>
<li><a href="#orgheadline123">hand のインタフェースを遵守</a></li>
<li><a href="#orgheadline124">hand_new, hand_size</a></li>
<li><a href="#orgheadline125">hand_add</a></li>
<li><a href="#orgheadline126">hand_card</a></li>
<li><a href="#orgheadline127">hand_draw</a></li>
<li><a href="#orgheadline128">文字列化</a></li>
<li><a href="#orgheadline129">hand_sort</a></li>
</ul>
</li>
<li><a href="#orgheadline132">test/test_judge.c</a>
<ul>
<li><a href="#orgheadline131">必要なライブラリのヘッ</a></li>
</ul>
</li>
<li><a href="#orgheadline138">hand/src/judge.c</a>
<ul>
<li><a href="#orgheadline133">必要なシステムライブラリのインタフェースを読む (定跡)</a></li>
<li><a href="#orgheadline134">依存するモジュールのインタフェースを読む(定跡)</a></li>
<li><a href="#orgheadline135">定数の宣言 (定跡)</a></li>
<li><a href="#orgheadline136">このファイル内でのみ有効な関数の宣言 (定跡)</a></li>
<li><a href="#orgheadline137">役の計算</a></li>
</ul>
</li>
<li><a href="#orgheadline139">hand/test/hand_test.h</a></li>
<li><a href="#orgheadline146">hand/test/hand_test_data.c</a>
<ul>
<li><a href="#orgheadline140">利用ライブライのヘッダを読む</a></li>
<li><a href="#orgheadline141">利用モジュールのヘッダを読む</a></li>
<li><a href="#orgheadline142">手札テストデータ操作用ヘッダを読む</a></li>
<li><a href="#orgheadline143">5枚のカードの組のデータ定義</a></li>
<li><a href="#orgheadline144">テストデータの初期化</a></li>
<li><a href="#orgheadline145">テストデータから Hand型データを生成する機能</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline157">Pokerモジュールの開発</a>
<ul>
<li><a href="#orgheadline156">ゲームモジュール</a>
<ul>
<li><a href="#orgheadline149">機能、設計，実装</a>
<ul>
<li><a href="#orgheadline150">ゲームの説明からゲームに関する部分を取り出す</a></li>
<li><a href="#orgheadline151">poker モジュールの機能</a></li>
<li><a href="#orgheadline152">poker モジュールの機能の名前</a></li>
<li><a href="#orgheadline153">poker モジュールの機能のインタフェース</a></li>
</ul>
</li>
<li><a href="#orgheadline154">~/progs/game/poker が開発ディレクトリ</a></li>
<li><a href="#orgheadline155">~/progs/game/Makefile</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/index.html">ソフト
ウェア構成論</a> /
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/lects/">毎回の講義</a>
/  <a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/org-docs/">講義
ドキュメント</a> /
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/org-docs/poker/">ポー
カーゲームの開発</a> /
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/info/game-repos.html">repos</a> /
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/lects/supplyments/">講義補足</a>
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">Pokerゲーム開発の始まり</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi">prog-wiki</a> を参考にしてください。
</p>
</div>

<div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">はじまり</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
Wikiサイト <a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E8%AC%9B%E7%BE%A9%E5%86%85%E5%AE%B9">Prog Wikky - 講義内容</a> の内容を，テストによる開発に会わせ
て，新しくドキュメントを作り直しています。
</p>
</div>

<div id="outline-container-orgheadline3" class="outline-4">
<h4 id="orgheadline3"><span class="done Done">Done</span> ポーカーゲーム作りの始まり</h4>
<div class="outline-text-4" id="text-orgheadline3">
<ul class="org-ul">
<li>あるゲームソフト会社で，無口な上司からの仕事依頼</li>
<li>今のあなたなら、どんな情報があれば考えられますか? 作れますか?</li>
</ul>
</div>

<div id="outline-container-orgheadline4" class="outline-5">
<h5 id="orgheadline4">カードモジュールつくってよ (@カードモジュールつくってよ)</h5>
<div class="outline-text-5" id="text-orgheadline4">
<p>
口数少ない上司:
</p>
<blockquote>
<p>
「ポーカーゲームを作ることになったから，カードモジュール作ってよ．」
</p>
</blockquote>

<p>
私:
</p>
<blockquote>
<p>
「＠_＠ 何を．．．どうやって．．．何が必要．．．」
</p>
</blockquote>

<p>
口数少ない上司:
</p>
<blockquote>
<p>
「自分で考えてね．一を聞いて十を知るのがカリスマプログラマだよね．」
</p>
</blockquote>

<p>
私:
</p>
<blockquote>
<p>
「＠_＠ ．．．．．．」
</p>
</blockquote>
</div>
</div>


<div id="outline-container-orgheadline5" class="outline-5">
<h5 id="orgheadline5">講義で考えているポーカーゲーム</h5>
<div class="outline-text-5" id="text-orgheadline5">
<p>
ここで想定しているポーカーとは以下を繰り返すことです：
</p>

<ul class="org-ul">
<li>山を作り直し，</li>

<li>5人のプレーヤに，</li>

<li>手札(5枚のカード) を配り，</li>

<li>2回までの手札の交換後，</li>

<li>手札役の強い順にプレーヤ名を表示する．
役については <a href="http://www6.airnet.ne.jp/spade/poker/rule/yaku.html">ポーカーの役についての説明</a> を参考にします。</li>
</ul>

<p>
ゲーム全体をプログラムするには，この説明から何をどうプログラムする
のかを考えなくてはなりません．
</p>

<ul class="org-ul">
<li>この中に含まれる「もの」と「操作」が洗い出せますか？
それらがプログラムする対象となります。</li>

<li>「もの」や「操作」を表す言葉は抽象化されていて，その中には隠され
た情報があることがわかりますか？</li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline6" class="outline-5">
<h5 id="orgheadline6">ゲーム説明とモジュールわけ</h5>
<div class="outline-text-5" id="text-orgheadline6">
<p>
ゲーム説明を仕様と考えます。
</p>

<ul class="org-ul">
<li>仕様中には主体や対象となる *もの*(名詞) が現れます。

<ul class="org-ul">
<li>ものの間には関係があり，依存関係で大きなものにまとめられるもの
もあります。</li>
</ul></li>

<li>主体や対象は，機能を行なうものや機能により処理されるもの，です。</li>

<li>仕様中に現れた <b>もの</b> 達を機能のまとめ役と考えます。</li>
</ul>

<p>
この <b>もの</b> を一つのまとまり (モジュール) として，考えていくこと
になります。
</p>

<p>
モジュール分けの良さの基準は曖昧ですが，一応結合度と凝集度という基
準があります。
</p>

<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/meta-ruby/lects/note/#outline-container-sec-2">メタプログラミング Ruby 講義ノート・メモ</a> のモジューラプログラミング
を参考にしてください。
</p>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-5">
<h5 id="orgheadline7">ゲーム説明の分析 (課題)</h5>
<div class="outline-text-5" id="text-orgheadline7">
<p>
ゲーム説明を読んで次の事を行なってみてください:
</p>
<ul class="org-ul">
<li>ものを取り出してください。</li>
<li>機能を取り出して下さい。</li>
<li>機能をもので分類してください。</li>
<li>機能の対象と結果が何かを分析してください。</li>
</ul>

<p>
講義の進行上，先生の分析とモジュール分けをもとに，開発を体験しても
らいますが，常に自分の分析と比較検討していって下さい。
</p>
</div>
</div>


<div id="outline-container-orgheadline8" class="outline-5">
<h5 id="orgheadline8">モジュール分け</h5>
<div class="outline-text-5" id="text-orgheadline8">
<p>
ここでは下記のように分けて考えます
</p>

<ul class="org-ul">
<li>カード</li>

<li>山</li>

<li>手札
<ul class="org-ul">
<li>役</li>
</ul></li>

<li>プレーヤー
<ul class="org-ul">
<li>プレーヤー名</li>
</ul></li>

<li>ゲームモジュール</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-4">
<h4 id="orgheadline11">テストの意味</h4>
<div class="outline-text-4" id="text-orgheadline11">
</div><div id="outline-container-orgheadline9" class="outline-5">
<h5 id="orgheadline9">「まずテストを書く」こと</h5>
<div class="outline-text-5" id="text-orgheadline9">
<p>
プログラム化することで問題が <b>現実化</b> され，プログラミング上の検討
の対象となります。
</p>

<p>
モジュール分け・機能分けの設計の良さ悪さを，テストを書くことで，具
体的に評価したいのです。
</p>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-5">
<h5 id="orgheadline10">フィードバック</h5>
<div class="outline-text-5" id="text-orgheadline10">
<p>
テストが 書けない/書きにくい なら，機能への分割が悪いかもしれません:
</p>

<ul class="org-ul">
<li>機能が粗く考えられている</li>

<li>機能への入力出力が明確でない</li>
</ul>

<p>
などが考えられます。他の原因も考えられます。
</p>

<p>
もっと前の段階の，機能をまとめるものが悪いことも考えられます。モジュー
ル分けが適切ではなかったということになります。
</p>

<p>
適切ではなかったと考えられる場合は，設計し直すことになります。
</p>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13">Card モジュールの開発</h2>
<div class="outline-text-2" id="text-orgheadline13">
</div><div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12">Cardモジュール</h3>
<div class="outline-text-3" id="text-orgheadline12">
<p>
card_display 問題をやったことで，カードの機能はほぼ
できています。
</p>

<p>
libcard.a がモジュールの本体で，
card.h がインタフェースとなります。
</p>

<p>
pokerゲームの開発は，~/progs/game/の下で行いますので，
~/progs/card_display/simple/ を
~/progs/game/card/にコピーしてください。
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #99968b;"># </span><span style="color: #99968b;">~/progs/card_display/simple</span>
mkdir  ~/progs/game/card/
cp -Rp * ~/progs/game/card/
<span style="color: #e5786d;">cd</span> ~/progs/game/card/
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh">make clean
make
</pre>
</div>

<p>
もし，Makefile 等にディレクトリに依存する内容があれば，書き換えて下
さい。
</p>

<p>
移動・変更後，card のすべてのテストが成功することを確かめましょう。
</p>

<p>
これでカードモジュールの開発は，一旦，終了です。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline75" class="outline-2">
<h2 id="orgheadline75">Deck モジュールの開発</h2>
<div class="outline-text-2" id="text-orgheadline75">
</div><div id="outline-container-orgheadline17" class="outline-3">
<h3 id="orgheadline17">山について考える</h3>
<div class="outline-text-3" id="text-orgheadline17">
</div><div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14">山の機能</h4>
<div class="outline-text-4" id="text-orgheadline14">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E5%B1%B1%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E6%A9%9F%E8%83%BD%E3%81%AE%E6%A4%9C%E8%A8%8E">山モジュールの機能の検討</a> (prog-wiki) も参考にしてください。
</p>
</div>

<div id="outline-container-orgheadline15" class="outline-5">
<h5 id="orgheadline15">ゲームの説明から山に関する部分を取り出す</h5>
<div class="outline-text-5" id="text-orgheadline15">
<ul class="org-ul">
<li>*山*を作り直し，
<ul class="org-ul">
<li>カードをシャッフルし、</li>
<li>カードを積み上げる</li>
</ul></li>

<li>手札(5枚のカード) を配り，
<ul class="org-ul">
<li>*山*の一番上のカードを引く</li>
</ul></li>

<li>2回までの手札の交換後，
<ul class="org-ul">
<li>*山*の一番上のカードを引く</li>
<li>（手札の）カードを捨てる
<ul class="org-ul">
<li>*ステ山*に積む</li>
</ul></li>
</ul></li>

<li>手札役の強い順にプレーヤ名を表示する</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-5">
<h5 id="orgheadline16">山モジュールの機能</h5>
<div class="outline-text-5" id="text-orgheadline16">
<p>
モジュールはトランプの山(という概念／機能) を提供する． 
</p>

<p>
それは以下：
</p>
<ul class="org-ul">
<li>山はカードの集まり．
<ul class="org-ul">
<li>カードを一列に積み上げる．</li>
</ul></li>
<li>山からカードを一枚引く.
<ul class="org-ul">
<li>山が空になったら，捨て札の山から，山を作り直す．</li>
</ul></li>
<li>(新しいトランプの組から)山を作り直す．
<ul class="org-ul">
<li>山を作り直すとき，シャッフルする．</li>
</ul></li>
<li>捨て札を捨てる．つまり、捨て山に積む。</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-3">
<h3 id="orgheadline18">テスト駆動開発の一サイクルのテンプレート</h3>
<div class="outline-text-3" id="text-orgheadline18">
<p>
モジュールの機能をテストします。
</p>

<p>
まず，機能の名前を決めます。
</p>
</div>

<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23">機能の設計</h4>
<div class="outline-text-4" id="text-orgheadline23">
</div><div id="outline-container-orgheadline22" class="outline-5">
<h5 id="orgheadline22">インタフェースの設計</h5>
<div class="outline-text-5" id="text-orgheadline22">
</div><div id="outline-container-orgheadline19" class="outline-6">
<h6 id="orgheadline19">インタフェースを考える</h6>
<div class="outline-text-6" id="text-orgheadline19">
<p>
機能が操作の場合
</p>
<ul class="org-ul">
<li>機能は箱，箱への入力と，箱からの出力を考える</li>
<li>入力と出力が何であるか決める</li>
</ul>

<p>
機能が物の場合
</p>
<ul class="org-ul">
<li>機能は箱，箱の中身を考える。</li>
<li>何からできているかを決める</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-6">
<h6 id="orgheadline20">テスト test_&#x2026; () を書く</h6>
</div>

<div id="outline-container-orgheadline21" class="outline-6">
<h6 id="orgheadline21">test/test_deck.o を作る (test/Makefile)</h6>
</div>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30">機能の実装</h4>
<div class="outline-text-4" id="text-orgheadline30">
</div><div id="outline-container-orgheadline29" class="outline-5">
<h5 id="orgheadline29">deck_new，deck_size の実装</h5>
<div class="outline-text-5" id="text-orgheadline29">
</div><div id="outline-container-orgheadline24" class="outline-6">
<h6 id="orgheadline24">インタフェースの確定 (src/deck.h)</h6>
</div>

<div id="outline-container-orgheadline25" class="outline-6">
<h6 id="orgheadline25">Deck を作る (src/deck.c)</h6>
</div>

<div id="outline-container-orgheadline26" class="outline-6">
<h6 id="orgheadline26">deck_new と deck_size を作る (src/deck.c)</h6>
</div>

<div id="outline-container-orgheadline27" class="outline-6">
<h6 id="orgheadline27">deck_new.o, deck_size.o を作る (src/Makefile)</h6>
</div>

<div id="outline-container-orgheadline28" class="outline-6">
<h6 id="orgheadline28">libdeck.a を作る (src/Makefile)</h6>
</div>
</div>
</div>


<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34">機能テスト</h4>
<div class="outline-text-4" id="text-orgheadline34">
</div><div id="outline-container-orgheadline33" class="outline-5">
<h5 id="orgheadline33">テスト</h5>
<div class="outline-text-5" id="text-orgheadline33">
</div><div id="outline-container-orgheadline31" class="outline-6">
<h6 id="orgheadline31">テスト test_deck.so のビルド</h6>
</div>

<div id="outline-container-orgheadline32" class="outline-6">
<h6 id="orgheadline32">テストの実行とデバッグ</h6>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline35" class="outline-3">
<h3 id="orgheadline35">山のテスト駆動開発</h3>
<div class="outline-text-3" id="text-orgheadline35">
<p>
山に名前をつけます。deck にします。
</p>
</div>

<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36">開発ディレクトリ</h4>
<div class="outline-text-4" id="text-orgheadline36">
<p>
~/progs/game/deck/{./, src/, test/} が開発に必要なディレクトリです。
</p>

<p>
Makefile を作っておきましょう。
</p>
<ul class="org-ul">
<li>card_display/simple/Makefile がそのまま使えるはずですよね。</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37">開発リポジトリ</h4>
<div class="outline-text-4" id="text-orgheadline37">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck">deck</a>
ソースコードの提示用に用意しました:
</p>

<ul class="org-ul">
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/test">deck/test</a>
<ul class="org-ul">
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/test/Makefile">deck/test/Makefile</a></li>
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/test/test_deck.c">deck/test/test_deck.c</a></li>
</ul></li>
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src">deck/src</a>
<ul class="org-ul">
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src/Makefiel">deck/src/Makefile</a></li>
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src/deck.h">deck/src/deck.h</a></li>
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src/deck.c">deck/src/deck.c</a></li>
</ul></li>
</ul>

<p>
コメントの形で，ソースコードブロックに名前がついています。その名前
で参照します。#+name:test-deck#new とかです。
</p>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38">card モジュールを利用するための決まり</h4>
<div class="outline-text-4" id="text-orgheadline38">
<p>
モジュール利用規則を決めておく
</p>
<ul class="org-ul">
<li>game/inlcude にヘッダファイルを置くことにする</li>
<li>game/lib にライブラリファイルを置くことにする</li>
</ul>

<p>
card.h, libcard.a も使えるようにcard/src/Makefile を書き換えて，
make install でgame/include に card.h を，game/lib に libcard.a
を，コピーする規則を付け加える。
</p>

<ul class="org-ul">
<li><a href="http://wiki.cis.iwate-u.ac.jp/~suzuki/lects/prog/lects/supplyments.html">講義補足</a> ((<a href="file:///users/home/masayuki/lects/prog/lects/supplyments.html">@cis.org</a> <a href="file:///users/home/masayuki/COMM/Lects/prog/site/lects/supplyments.html">@s.org</a>)) のMakefileを参考にしてください。</li>
<li><a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/card/src/Makefiel">card/src/Makefile</a> を参考にしてください。</li>
<li>card/src/Makefileが修正できたら，make install して，
card.h, libcard.a がコピーできたことを確認してください。</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39">山 (Deck) の機能の設計・実装・テスト</h4>
<div class="outline-text-4" id="text-orgheadline39">
<p>
山はこのモジュールの主体である <b>もの*。*もの</b> はデータ構造となり，
型 (または実体(変数)) となります。
</p>

<p>
<b>もの</b> は生まれ・作られ，状態を持つ。
</p>

<p>
この状態をテストする。
</p>

<p>
はじめは簡単なテストしか書けないが，
他の機能ができてから，より詳しいテストができるようになる。
</p>
</div>

<div id="outline-container-orgheadline41" class="outline-5">
<h5 id="orgheadline41">インタフェースの設計</h5>
<div class="outline-text-5" id="text-orgheadline41">
</div><div id="outline-container-orgheadline40" class="outline-6">
<h6 id="orgheadline40">インタフェースを考える</h6>
<div class="outline-text-6" id="text-orgheadline40">
<p>
頭の中や，紙と鉛筆や，Emacs org-mode を使って，考える。
</p>

<ul class="org-ul">
<li>52枚のカードから山を作る:
<ul class="org-ul">
<li>引き札の山に52枚のカードが積まれ，</li>
<li>捨て札の山は0枚のカードが積まれている，状態を作る</li>
<li>二つの山は，山モジュールの中に隠れていて，プレーヤに見えてなくてもいい</li>
<li>引き札の山から一枚のカードが引かれ，</li>
<li>捨て札の山に一枚のカードが捨てらればいい。</li>
</ul></li>
</ul>

<p>
ある程度見通しがたったら，test/test_deck.c に書き始める。
</p>

<pre class="example">
deck_new();
</pre>

<ul class="org-ul">
<li>テストにするため，検査の式を書く:</li>
</ul>

<pre class="example">
deck_size(deck)==52
</pre>

<ul class="org-ul">
<li><p>
deck_size()は山のカードの枚数を返す関数。新たな機能の登場。
</p>

<p>
良さそう
</p></li>
</ul>
<ul class="org-ul">
<li><p>
インタフェースを書く
</p>

<pre class="example">
void deck_new (void);
int deck_size (void);
</pre>

<p>
良さそう。
</p></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-5">
<h5 id="orgheadline42">テスト test_deck_new() を書く</h5>
<div class="outline-text-5" id="text-orgheadline42">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/test/test_deck.c">deck/test/test_deck.c</a>  #+name:test-deck#new に当たるテスト関数です。
</p>
</div>

<div id="outline-container-orgheadline43" class="outline-6">
<h6 id="orgheadline43">test/test_deck.o を作る</h6>
<div class="outline-text-6" id="text-orgheadline43">
<p>
test/test_deck.c から test/test_deck.o を作りたいです。
</p>

<p>
test/Makefile が必要になります。
game/card/test/Makefile を参考に，deck/test用の Makefile を書いてください。
copy して，変更してもいい。
</p>

<p>
<a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/test/Makefile">deck/test/Makefile</a> のようになります。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-5">
<h5 id="orgheadline50">deck_new，deck_size の実装</h5>
<div class="outline-text-5" id="text-orgheadline50">
</div><div id="outline-container-orgheadline44" class="outline-6">
<h6 id="orgheadline44">インタフェースの確定 (src/deck.h)</h6>
<div class="outline-text-6" id="text-orgheadline44">
<p>
deck/test/test_deck.c にあったインタフェースを
deck/src/deck.h に移します。
</p>

<p>
<a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src/deck.h">deck/src/deck.h</a> 中の下記部分になります。
</p>
<ul class="org-ul">
<li>#+name:deck.h#include</li>
<li>#+name:deck.h#new</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-6">
<h6 id="orgheadline45">Deck を作る (src/deck.c)</h6>
<div class="outline-text-6" id="text-orgheadline45">
<p>
山の型と実体を作ります。
</p>

<ul class="org-ul">
<li>52枚のカードから山を作る:
<ul class="org-ul">
<li>引き札の山に52枚のカードが積まれ，</li>
<li>捨て札の山は0枚のカードが積まれている，状態を作る</li>
<li>二つの山は，山モジュールの中に隠れていて，プレーヤに見えてなくてもいい</li>
</ul></li>
</ul>

<p>
なので，
</p>
<ul class="org-ul">
<li><p>
山は構造体 
</p>
<pre class="example">
struct _Deck {};
</pre></li>
<li><p>
52枚のカードが積まれ
</p>
<pre class="example">
# include &lt;Card&gt;
struct _Deck {Card cards[52];};
</pre></li>
<li><p>
0枚のカードが積まれている，状態
</p>
<pre class="example">
# include &lt;Card&gt;
struct _Deck {Card cards[52]; int size};
</pre></li>

<li>引き札の山, 捨て札の山,</li>
<li><p>
二つの山は，山モジュールの中に隠れていて，プレーヤに見えてなく
てもいい
</p>
<pre class="example">
# include &lt;Card&gt;
struct _Deck {Card cards[52]; int size};
typedef struct _Deck Deck;
static Deck using;
static Deck used;
</pre></li>
</ul>

<p>
ということで， <a href="http://wiki.cis.iwate-u.ac.jp/svn/prog/2015/progs/game/deck/src/deck.c">deck/src/deck.c</a> の
</p>
<ul class="org-ul">
<li>#+name:deck.c#include</li>
<li>#+name:deck.c#Deck</li>
</ul>
<p>
ができあがります。
</p>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-6">
<h6 id="orgheadline46"><span class="todo Todo">Todo</span> new と size を作る (src/deck.c)</h6>
<div class="outline-text-6" id="text-orgheadline46">
<p>
deck_new, deck_size を自分で実装してみましょう。
</p>
</div>
</div>

<div id="outline-container-orgheadline48" class="outline-6">
<h6 id="orgheadline48"><span class="todo Todo">Todo</span> deck.o を作る (src/deck.o)</h6>
<div class="outline-text-6" id="text-orgheadline48">
</div><div id="outline-container-orgheadline47" class="outline-7">
<h7 id="orgheadline47"><span class="todo Todo">Todo</span> deck/src/Makefile の変更</h7>
<div class="outline-text-7" id="text-orgheadline47">
<ul class="org-ul">
<li>~/progs/game/include/card.h が使えるようにする</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-6">
<h6 id="orgheadline49"><span class="todo Todo">Todo</span> libdeck.a を作る</h6>
<div class="outline-text-6" id="text-orgheadline49">
<p>
ただ make すればよいでしょう。
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline53" class="outline-5">
<h5 id="orgheadline53"><span class="todo Todo">Todo</span> テスト</h5>
<div class="outline-text-5" id="text-orgheadline53">
</div><div id="outline-container-orgheadline51" class="outline-6">
<h6 id="orgheadline51"><span class="todo Todo">Todo</span> テスト test_deck.so のビルド</h6>
<div class="outline-text-6" id="text-orgheadline51">
<ul class="org-ul">
<li>~/progs/game/lib/libcard.a が使えるようにする</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-6">
<h6 id="orgheadline52"><span class="todo Todo">Todo</span> テストの実行とデバッグ</h6>
</div>
</div>
</div>

<div id="outline-container-orgheadline54" class="outline-4">
<h4 id="orgheadline54"><span class="todo Todo">Todo</span> 山から引く機能の設計・実装・テスト</h4>
<div class="outline-text-4" id="text-orgheadline54">
<p>
山 (積み重ねられたカード) の一番上のカードを引く
</p>
</div>

<div id="outline-container-orgheadline55" class="outline-6">
<h6 id="orgheadline55">インタフェースの設計</h6>
<div class="outline-text-6" id="text-orgheadline55">
<p>
Card c = deck_draw();
</p>
</div>
</div>

<div id="outline-container-orgheadline56" class="outline-6">
<h6 id="orgheadline56">テスト</h6>
<div class="outline-text-6" id="text-orgheadline56">
<p>
deck_size()==51     
</p>
</div>
</div>

<div id="outline-container-orgheadline57" class="outline-5">
<h5 id="orgheadline57">deck_draw をテストする:</h5>
<div class="outline-text-5" id="text-orgheadline57">
<p>
test_deck.c#deck_draw)
</p>

<pre class="example">
deck_new();
Card a = deck_draw();
cut_assert(deck_size(stock) == 51)
</pre>
</div>
</div>

<div id="outline-container-orgheadline58" class="outline-5">
<h5 id="orgheadline58">deck.h への追加変更</h5>
<div class="outline-text-5" id="text-orgheadline58">
<p>
src/deck.h
</p>
<pre class="example">
Card deck_draw(void);
</pre>
</div>
</div>

<div id="outline-container-orgheadline59" class="outline-5">
<h5 id="orgheadline59">deck.c への追加変更</h5>
<div class="outline-text-5" id="text-orgheadline59">
<div class="org-src-container">

<pre class="src src-nillangnilswitchesnilflags" id="orgsrcblock1">nilbody
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline60" class="outline-5">
<h5 id="orgheadline60">deck.o の作成</h5>
</div>

<div id="outline-container-orgheadline61" class="outline-5">
<h5 id="orgheadline61">libdeck.a の作成</h5>
</div>

<div id="outline-container-orgheadline62" class="outline-5">
<h5 id="orgheadline62">test_deck.so の作成</h5>
</div>

<div id="outline-container-orgheadline63" class="outline-5">
<h5 id="orgheadline63">test</h5>
</div>
</div>

<div id="outline-container-orgheadline64" class="outline-4">
<h4 id="orgheadline64"><span class="todo Todo">Todo</span> カードを捨てる (test_deck.c#test_discard)</h4>
<div class="outline-text-4" id="text-orgheadline64">
<p>
書いてみる
</p>
<pre class="example">
n = deck_discard(c);
</pre>

<ul class="org-ul">
<li>カードを一枚捨てる</li>
<li>捨てられたカードの枚数が帰ってくる</li>
<li>ちょっと不自然か？</li>
<li>捨て山の枚数を取得する関数を用意したほうがいいかも</li>
</ul>

<p>
deck.h
</p>
<pre class="example">
int deck_discard(Card);
</pre>

<p>
draw.c への変更追加
</p>
<ul class="org-ul">
<li>捨て山</li>
</ul>
<pre class="example">
static Deck used;
</pre>

<ul class="org-ul">
<li>捨てる</li>
</ul>
<pre class="example">
int deck_discard(Card a)
{
   used.cards[used.size++]=a;
   return used.size;
}
</pre>
</div>
</div>

<div id="outline-container-orgheadline72" class="outline-4">
<h4 id="orgheadline72"><span class="todo Todo">Todo</span> 山の再構成 (deck_renew)</h4>
<div class="outline-text-4" id="text-orgheadline72">
</div><div id="outline-container-orgheadline65" class="outline-5">
<h5 id="orgheadline65">機能</h5>
<div class="outline-text-5" id="text-orgheadline65">
<p>
引き山がなくなり，捨て山から引き山を作り直す。
</p>

<p>
Deckモジュール内で利用する機能
</p>

<p>
deck_renew
</p>
</div>
</div>

<div id="outline-container-orgheadline66" class="outline-5">
<h5 id="orgheadline66">テストする</h5>
<div class="outline-text-5" id="text-orgheadline66">
<p>
53枚引いて捨てて，山の枚数を確かめる。
</p>

<pre class="example">
deck_new();
while(deck_size()&gt;0) 
  deck_discard(deck_draw()); 
int n = deck_discar(deck_draw());
cut_assert(deck_size()==51)
cut_assert(n == 1)
</pre>
</div>
</div>

<div id="outline-container-orgheadline67" class="outline-5">
<h5 id="orgheadline67">renewの実装 (src/deck.c#renew)</h5>
<div class="outline-text-5" id="text-orgheadline67">
<pre class="example">
using = used
used.size = 0
</pre>
</div>
</div>

<div id="outline-container-orgheadline68" class="outline-5">
<h5 id="orgheadline68">deck.o の作成</h5>
</div>

<div id="outline-container-orgheadline69" class="outline-5">
<h5 id="orgheadline69">libdeck.a の作成</h5>
</div>

<div id="outline-container-orgheadline70" class="outline-5">
<h5 id="orgheadline70">test_deck.so の作成</h5>
</div>

<div id="outline-container-orgheadline71" class="outline-5">
<h5 id="orgheadline71">test</h5>
</div>
</div>
<div id="outline-container-orgheadline73" class="outline-4">
<h4 id="orgheadline73"><span class="todo Todo">Todo</span> シャッフル</h4>
<div class="outline-text-4" id="text-orgheadline73">
<ul class="org-ul">
<li>0~stock.top-1 のカードを
<ul class="org-ul">
<li>適当な回数</li>
<li>適当な2枚を入れ替える</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline74" class="outline-4">
<h4 id="orgheadline74">山を印刷</h4>
<div class="outline-text-4" id="text-orgheadline74">
<p>
test_print.cの作成
</p>
<pre class="example">
# include &lt;deck.h&gt;
Deck_newしてDeck_topが０になるまで，
while (Deck_top()&gt;0)
  printf("%s\n", Card_to_str(Deck_draw());
</pre>

<p>
デバッグ用
print.c の作成 
</p>
<pre class="example">
void Deck_print(Deck deck)
{
    for (i=0; i&lt;deck.top; i++)
      printf("%s\n", Card_to_string(deck.cards[i]))
}
</pre>

<p>
インターフェイスへの変更はない．test_deck の一部と考えられる．
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline148" class="outline-2">
<h2 id="orgheadline148">Hand モジュールの開発</h2>
<div class="outline-text-2" id="text-orgheadline148">
</div><div id="outline-container-orgheadline97" class="outline-3">
<h3 id="orgheadline97">手札について考える</h3>
<div class="outline-text-3" id="text-orgheadline97">
</div><div id="outline-container-orgheadline76" class="outline-4">
<h4 id="orgheadline76">手札の機能</h4>
<div class="outline-text-4" id="text-orgheadline76">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E6%89%8B%E6%9C%AD%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E8%A8%AD%E8%A8%88">Prog Wikky - 手札モジュールの設計</a> も参考にしてください。
</p>
</div>

<div id="outline-container-orgheadline77" class="outline-5">
<h5 id="orgheadline77">ゲームの説明から手札に関する部分を取り出す</h5>
<div class="outline-text-5" id="text-orgheadline77">
<ul class="org-ul">
<li>手札(5枚のカード) を配り，
<ul class="org-ul">
<li>山から引いたカードを (ここは手札には関係ないが)</li>
<li>手札に入れ，</li>
<li>手札をソートする</li>
</ul></li>

<li>2回までの手札の交換後，
<ul class="org-ul">
<li>手札のカードを引き，</li>
<li>そのカードを捨て，</li>
<li>山から引いたカードを (ここは手札には関係ないが)</li>
<li>手札に入れ，</li>
<li>手札をソートする</li>
</ul></li>

<li>手札役の強い順にプレーヤ名を表示する 
<ul class="org-ul">
<li>手札の <b>役</b> 判定</li>
<li>プレーヤーは関係なし</li>
</ul></li>
</ul>

<p>
手札に関する説明に出てくる「もの」達は，「役」以外既知のもの。
</p>

<p>
「役」をどう扱うかは，要検討。
</p>
</div>
</div>


<div id="outline-container-orgheadline78" class="outline-5">
<h5 id="orgheadline78">手札モジュールの機能</h5>
<div class="outline-text-5" id="text-orgheadline78">
<p>
モジュールはポーカーの手札(という概念／機能) を提供する． 
</p>

<p>
それは以下：
</p>
<ul class="org-ul">
<li>手札は5枚のカードの集まり．</li>
<li>手札に一枚加える</li>
<li>手札から選んだ一枚を引き抜く</li>
<li>手札のソート</li>
<li>手札の役を計算する</li>
</ul>

<p>
入出力に関する機能
</p>
<ul class="org-ul">
<li>手札の表示</li>
<li>役の名前</li>
</ul>

<p>
これで，必要充分なのか，足りないのか，余計なものがあるのか考えます
が，テスト駆動開発では，仕様の変更を恐れず，開発を進めながら，考え
ていきます。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline96" class="outline-4">
<h4 id="orgheadline96">機能の設計</h4>
<div class="outline-text-4" id="text-orgheadline96">
</div><div id="outline-container-orgheadline79" class="outline-5">
<h5 id="orgheadline79">機能の名前</h5>
<div class="outline-text-5" id="text-orgheadline79">
<p>
先ず，機能の説明から，その機能に名前をつけましょう。
</p>

<p>
今回の開発では，主体と操作を結合して名前を決めることにしています。
</p>
</div>

<div id="outline-container-orgheadline80" class="outline-6">
<h6 id="orgheadline80">手札を作ることに関する機能達</h6>
<div class="outline-text-6" id="text-orgheadline80">
<p>
手札はこのモジュールの主体である <b>もの*。
*もの</b> はデータ構造となり， 型 (または実体(変数)) となります。
</p>

<p>
手札の英語名は，hand。
これがモジュールを纏める主体となります。 hand を*モジュールの名前*とし
ます。
</p>

<p>
操作には，主体が手札であることを表す hand_ を付けることにしています。
</p>

<ul class="org-ul">
<li>手札 - <b>Hand</b>
<ul class="org-ul">
<li>手札は最大5枚のカードの集まり。</li>
</ul></li>

<li>空の手札を作る - <b>hand_new</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 空の手札を作る new</li>
</ul></li>

<li>手札の枚数を計算する - <b>hand_size</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札の枚数 size</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline81" class="outline-6">
<h6 id="orgheadline81">手札に一枚加える/引く機能達</h6>
<div class="outline-text-6" id="text-orgheadline81">
<ul class="org-ul">
<li>手札に一枚加える - <b>hand_add</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： カードを加える add</li>
</ul></li>

<li>手札から選んだ一枚を引き抜く - <b>hand_draw</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： カードを引く draw</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline82" class="outline-6">
<h6 id="orgheadline82">手札の全カードを扱う機能達</h6>
<div class="outline-text-6" id="text-orgheadline82">
<ul class="org-ul">
<li>手札のソート - <b>hand_sort</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札をソート sort</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>手札を文字列に - <b>hand_to_string</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札を文字列に (convert_)to_string. 長いし，曖昧性がないの
で，convert_を省略します。</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline83" class="outline-6">
<h6 id="orgheadline83">役に関する機能達</h6>
<div class="outline-text-6" id="text-orgheadline83">
<p>
役の英語訳は，poker hand.
役は手札に関する付加情報と考え，モジュールを構成する主体とは考えなかっ
た。
</p>

<ul class="org-ul">
<li>手札の役を計算する - <b>hand_calc</b>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li><p>
操作 ： 役の計算 calc
</p>

<p>
下請けの関数として，が考えられるが，今は詳細として，隠しておき，
hand_calc のテスト駆動開発の時に，検討しましょう:
</p>
<ul class="org-ul">
<li>hand_is_straight &#x2013; 手札はストレートか？</li>
<li>hand_is_flush &#x2013; 手札はフラッシュか？</li>
<li>hand_calc_pairs &#x2013; ペアを計算する</li>
</ul></li>
</ul></li>

<li>役 <b>PokerHand</b> (物)
<ul class="org-ul">
<li>役のこと，いくつか具体的な役の名前の集まり</li>
<li>なので型</li>
<li>型は capital words で表すので，_P_oker_H_and.</li>
</ul></li>
</ul>


<ul class="org-ul">
<li>役を文字列に - <b>hand_pokerhand_to_string</b>
<ul class="org-ul">
<li>主体 ： hand?</li>
<li>操作 ： 役を文字列に pokerhand_to_string</li>
</ul></li>
</ul>
</div>
</div>
</div>


<div id="outline-container-orgheadline84" class="outline-5">
<h5 id="orgheadline84">インタフェースを考える (deckと同じ)</h5>
<div class="outline-text-5" id="text-orgheadline84">
<p>
機能が操作の場合
</p>
<ul class="org-ul">
<li>機能は箱，箱への入力と，箱からの出力を考える</li>
<li>入力と出力が何であるか決める</li>
</ul>

<p>
機能が物の場合
</p>
<ul class="org-ul">
<li>機能は箱，箱の中身を考える。</li>
<li>何からできているかを決める</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline85" class="outline-5">
<h5 id="orgheadline85">機能のインタフェース</h5>
<div class="outline-text-5" id="text-orgheadline85">
<p>
主体，操作から機能の名前は決まっています。あとは，対象物と，操作の
結果の型を洗いだしていきます。
</p>
</div>

<div id="outline-container-orgheadline86" class="outline-6">
<h6 id="orgheadline86">手札</h6>
<div class="outline-text-6" id="text-orgheadline86">
<p>
手札とは
</p>
<ul class="org-ul">
<li>カードと枚数からなる。したがって，手札は構造体。</li>
<li>ゲーム中，手札は，いくつも存在する。変数ではなく，型となる。型
名は，最初の一文字を大文字で表す (capital word) ことにしていま
す。 Hand とします。</li>
<li>構造体の中身は，テスト駆動開発時の機能の実装を行なうときに，考
えることにします。</li>
</ul>

<p>
これらのことから，Hand は下記のようにC言語の宣言で書くことができま
す: 
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #8ac6f2; font-weight: bold;">typedef</span> <span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">_Hand</span> <span style="color: #92a65e; font-weight: bold;">Hand</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline87" class="outline-6">
<h6 id="orgheadline87">hand_new</h6>
<div class="outline-text-6" id="text-orgheadline87">
<p>
空の手札を作る     
</p>


<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 空の手札を作る new</li>
<li>対象物 ： なし</li>
<li>結果 ： Hand</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_new</span>(<span style="color: #92a65e; font-weight: bold;">void</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline88" class="outline-6">
<h6 id="orgheadline88">hand_size</h6>
<div class="outline-text-6" id="text-orgheadline88">
<p>
手札の枚数を計算する
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札の枚数 size</li>
<li>対象物 ： 手札</li>
<li>結果 ： 枚数 int</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_size</span>(Hand);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline89" class="outline-6">
<h6 id="orgheadline89">hand_add</h6>
<div class="outline-text-6" id="text-orgheadline89">
<p>
手札に一枚カードを加える
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： カードを加える add</li>
<li>対象物 ： 手札に，カードを (Hand, Card)</li>
<li>結果 ： 一枚カードが付加えられた手札 Hand</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_add</span> (<span style="color: #92a65e; font-weight: bold;">Hand</span>, Card);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline90" class="outline-6">
<h6 id="orgheadline90">hand_draw</h6>
<div class="outline-text-6" id="text-orgheadline90">
<p>
手札から選んだ一枚を引き抜く
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： カードを引く draw</li>
<li>対象物 ： 手札から，指定したカードを (Hand, どの手札か)</li>
<li>結果 ： 一枚カードが引かれた手札 Hand</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_draw</span> (<span style="color: #92a65e; font-weight: bold;">Hand</span>, <span style="color: #92a65e; font-weight: bold;">int</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline91" class="outline-6">
<h6 id="orgheadline91">hand_sort</h6>
<div class="outline-text-6" id="text-orgheadline91">
<p>
手札の5枚のカードをソート
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札の全カードをソート sort</li>
<li>対象物 ： 手札 (Hand)</li>
<li>結果 ： ソートされた手札 Hand</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_sort</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline92" class="outline-6">
<h6 id="orgheadline92">hand_to_string</h6>
<div class="outline-text-6" id="text-orgheadline92">
<p>
手札を文字列に
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札を表す文字列を作る to_string</li>
<li>対象物 ： 手札 (Hand)</li>
<li>結果 ： 文字列 char *</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_to_string</span>(Hand);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline93" class="outline-6">
<h6 id="orgheadline93">hand_calc</h6>
<div class="outline-text-6" id="text-orgheadline93">
<p>
手札の役を計算する
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 手札のソート sort</li>
<li>対象物 ： 手札 (Hand)</li>
<li>結果 ： 役 PokerHand</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">hand_calc</span>(Hand);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline94" class="outline-6">
<h6 id="orgheadline94">PokerHand (物)</h6>
<div class="outline-text-6" id="text-orgheadline94">
<p>
役(値)の集まり
</p>

<ul class="org-ul">
<li>HighCards, OnePair, TwoPairs, ThreeCards, Straight, Flush,
FullHouse, FourCards, StraightFlush</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #8ac6f2; font-weight: bold;">enum</span> <span style="color: #92a65e; font-weight: bold;">PokerHand</span> { <span style="color: #cae682;">HighCards</span>, <span style="color: #cae682;">OnePair</span>, <span style="color: #cae682;">TwoPairs</span>, <span style="color: #cae682;">ThreeCards</span>, <span style="color: #cae682;">Straight</span>, <span style="color: #cae682;">Flush</span>,
                 <span style="color: #cae682;">FullHouse</span>, <span style="color: #cae682;">FourCards</span>, <span style="color: #cae682;">StraightFlush</span> };
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline95" class="outline-6">
<h6 id="orgheadline95">poker_hand_to_string</h6>
<div class="outline-text-6" id="text-orgheadline95">
<p>
役値を文字列に
</p>
<ul class="org-ul">
<li>主体 ： 手札 hand</li>
<li>操作 ： 役を表す文字列を作る pokerhand_to_string</li>
<li>対象物 ： 役 (PokerHand)</li>
<li>結果 ： 文字列 char *</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_pokerhand_to_string</span> (PokerHand);
</pre>
</div>
</div>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline103" class="outline-3">
<h3 id="orgheadline103">開発の決まり (deckとほぼ同じ)</h3>
<div class="outline-text-3" id="text-orgheadline103">
</div><div id="outline-container-orgheadline98" class="outline-4">
<h4 id="orgheadline98">開発ディレクトリ</h4>
<div class="outline-text-4" id="text-orgheadline98">
<p>
~/progs/game/hand/{./, src/, test/} が開発に必要なディレクトリです。
</p>
</div>
</div>


<div id="outline-container-orgheadline99" class="outline-4">
<h4 id="orgheadline99">開発リポジトリ</h4>
<div class="outline-text-4" id="text-orgheadline99">
<p>
hand の内容は，来週の講義後，アップします。
</p>
</div>
</div>

<div id="outline-container-orgheadline100" class="outline-4">
<h4 id="orgheadline100">他のモジュールを利用するための決まり</h4>
<div class="outline-text-4" id="text-orgheadline100">
<p>
deckと同じ
</p>
</div>
</div>

<div id="outline-container-orgheadline101" class="outline-4">
<h4 id="orgheadline101">Makefileの準備</h4>
<div class="outline-text-4" id="text-orgheadline101">
<ul class="org-ul">
<li>hand/Makefile
<ul class="org-ul">
<li>deck/Makefile がそのまま使えるはずですよね。</li>
</ul></li>

<li>hand/test/Makefile
<ul class="org-ul">
<li>deck/test/Makefile の deck を hand に置き換えれば，そのまま使え
そうです。</li>
</ul></li>

<li>hand/src/Makefile
<ul class="org-ul">
<li>deck/src/Makefile の deck を hand に置き換えれば，そのまま使え
そうです。</li>
</ul></li>
</ul>

<p>
確かめながら，それぞれの Makefile を作成してください。
</p>
</div>
</div>

<div id="outline-container-orgheadline102" class="outline-4">
<h4 id="orgheadline102">テスト駆動開発の一サイクルのテンプレート</h4>
<div class="outline-text-4" id="text-orgheadline102">
<p>
deckとほぼ同じ
</p>
</div>
</div>
</div>


<div id="outline-container-orgheadline104" class="outline-3">
<h3 id="orgheadline104">手札のテスト駆動開発</h3>
<div class="outline-text-3" id="text-orgheadline104">
<p>
deck モジュールを参考に，一つづつテスト駆動開発してみましょう。
</p>

<p>
一つづつ機能ができ，集まって hand の機能群 (モジュール)になり，
</p>

<p>
モジュール群の開発が徐々に行なわれ，手札の操作，役判定ができ，だんだ
んゲームができそうな雰囲気がでてくるはずです。
</p>

<p>
開発については，レポートにします。
</p>
</div>
</div>

<div id="outline-container-orgheadline147" class="outline-3">
<h3 id="orgheadline147">作成された手札モジュールの解説</h3>
<div class="outline-text-3" id="text-orgheadline147">
</div><div id="outline-container-orgheadline113" class="outline-4">
<h4 id="orgheadline113">src/hand.h</h4>
<div class="outline-text-4" id="text-orgheadline113">
</div><div id="outline-container-orgheadline105" class="outline-5">
<h5 id="orgheadline105">一回だけしか，include できなくする</h5>
<div class="outline-text-5" id="text-orgheadline105">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># pragma</span> once
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline106" class="outline-5">
<h5 id="orgheadline106">依存するモジュールのインタフェースを読む</h5>
<div class="outline-text-5" id="text-orgheadline106">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;card.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline107" class="outline-5">
<h5 id="orgheadline107">hand 型の定義</h5>
<div class="outline-text-5" id="text-orgheadline107">
<p>
hand モジュールの主体 Hand型を定義する.
</p>

<ul class="org-ul">
<li>最大5枚のカード</li>
<li>手札の枚数。出し入れがあるため。</li>
</ul>

<p>
からなる構造体:
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># define</span> <span style="color: #cae682;">CardsInHand</span> 5 <span style="color: #99968b;">//</span><span style="color: #99968b;">02.01 added</span>

<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">_Hand</span> {
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">cards</span>[5];
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">size</span>;
};

<span style="color: #8ac6f2; font-weight: bold;">typedef</span> <span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">_Hand</span> <span style="color: #92a65e; font-weight: bold;">Hand</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline108" class="outline-5">
<h5 id="orgheadline108">手札の作成と状態を知る機能</h5>
<div class="outline-text-5" id="text-orgheadline108">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_new</span>(<span style="color: #92a65e; font-weight: bold;">void</span>);
<span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_size</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline109" class="outline-5">
<h5 id="orgheadline109">手札の出し入れ</h5>
<div class="outline-text-5" id="text-orgheadline109">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_add</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>, Card); <span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12395;&#19968;&#26522;&#12459;&#12540;&#12489;&#12434;&#21152;&#12360;&#12427;</span>
<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_draw</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>, <span style="color: #92a65e; font-weight: bold;">int</span>); <span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12363;&#12425;&#19968;&#26522;&#12459;&#12540;&#12489;&#12434;&#25244;&#12367;</span>
<span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">hand_card</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>, <span style="color: #92a65e; font-weight: bold;">int</span>); <span style="color: #99968b;">// </span><span style="color: #99968b;">02.02 added &#25163;&#26413;&#20013;&#12398;&#12459;&#12540;&#12489;&#12434;&#35211;&#12427;</span>
                           <span style="color: #99968b;">// </span><span style="color: #99968b;">&#30058;&#21495;&#12398;&#25351;&#23450;&#12399; 1..5</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline110" class="outline-5">
<h5 id="orgheadline110">ソート</h5>
<div class="outline-text-5" id="text-orgheadline110">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_sort</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span>); <span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12398;&#12477;&#12540;&#12488;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline111" class="outline-5">
<h5 id="orgheadline111">手札の表示（用文字列の生成）</h5>
<div class="outline-text-5" id="text-orgheadline111">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12398;&#34920;&#31034;&#65288;&#29992;&#25991;&#23383;&#21015;&#12398;&#29983;&#25104;&#65289;</span>
<span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_to_string</span>(Hand);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline112" class="outline-5">
<h5 id="orgheadline112">役に関する定義</h5>
<div class="outline-text-5" id="text-orgheadline112">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#12395;&#38306;&#12377;&#12427;&#23450;&#32681;</span>
<span style="color: #8ac6f2; font-weight: bold;">typedef</span> 
 <span style="color: #8ac6f2; font-weight: bold;">enum</span> {
  <span style="color: #cae682;">HighCard</span> = 1,
  <span style="color: #cae682;">OnePair</span>,
  <span style="color: #cae682;">TwoPairs</span>,
  <span style="color: #cae682;">ThreeCards</span>,
  <span style="color: #cae682;">Straight</span>,
  <span style="color: #cae682;">Flush</span>,
  <span style="color: #cae682;">FullHouse</span>,
  <span style="color: #cae682;">FourCards</span>,
  <span style="color: #cae682;">StraightFlush</span>
}
  <span style="color: #92a65e; font-weight: bold;">PokerHand</span>;
</pre>
</div>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#12398;&#35336;&#31639;</span>
<span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">hand_judge</span>(Hand);
<span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#12398;&#21517;&#21069;</span>
<span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_pokerhand_to_string</span>(<span style="color: #92a65e; font-weight: bold;">PokerHand</span>);
</pre>
</div>


<p>
// C-c C-v C-t :
</p>
</div>
</div>
</div>
<div id="outline-container-orgheadline121" class="outline-4">
<h4 id="orgheadline121">test_hand.c</h4>
<div class="outline-text-4" id="text-orgheadline121">
</div><div id="outline-container-orgheadline114" class="outline-5">
<h5 id="orgheadline114">test_hand header</h5>
<div class="outline-text-5" id="text-orgheadline114">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">//</span><span style="color: #99968b;">~/progs/game/hand/test/test_hand.c</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;cutter.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;string.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;stdio.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline115" class="outline-5">
<h5 id="orgheadline115">手札の生成のテスト</h5>
<div class="outline-text-5" id="text-orgheadline115">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>手札ができ，枚数が0枚であること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_new</span>(<span style="color: #92a65e; font-weight: bold;">void</span>)
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();

  cut_set_message(<span style="color: #95e454;">"hand_new"</span>);
  cut_assert(hand_size(h)==0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline116" class="outline-5">
<h5 id="orgheadline116">手札へのカードの追加</h5>
<div class="outline-text-5" id="text-orgheadline116">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>カードを2枚追加し，手札の枚数が1づつ増えること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_add</span>(<span style="color: #92a65e; font-weight: bold;">void</span>)
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c1</span> = card_new(SPADE,ACE);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c2</span> = card_new(HEART,KING);

  cut_set_message(<span style="color: #95e454;">"hand_add"</span>);
  h = hand_add(h, c1);
  cut_assert(hand_size(h)==1);
  h = hand_add(h, c2);
  cut_assert(hand_size(h)==2);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline117" class="outline-5">
<h5 id="orgheadline117">手札の no 番目のカードのテスト</h5>
<div class="outline-text-5" id="text-orgheadline117">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>手札にカードを加え，手札がそのカードからなっていること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_card</span>(<span style="color: #92a65e; font-weight: bold;">void</span>)
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c1</span> = card_new(SPADE,ACE);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c2</span> = card_new(HEART,KING);

  cut_set_message(<span style="color: #95e454;">"hand_card"</span>);
  h = hand_add(h, c1);
  h = hand_add(h, c2);
  
  cut_assert(card_compare(c1, hand_card(h, 0))==0);
  cut_assert(card_compare(c2, hand_card(h, 1))==0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline118" class="outline-5">
<h5 id="orgheadline118">手札から1枚引く</h5>
<div class="outline-text-5" id="text-orgheadline118">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>手札にカードを加え，</li>
<li>加えた順でカードの情報が得られること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_draw</span>()
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c1</span> = card_new(SPADE, QUEEN);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c2</span> = card_new(HEART, QUEEN);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c3</span> = card_new(CLUB, QUEEN);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c4</span> = card_new(DIAMOND, QUEEN);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c5</span> = card_new(SPADE, JACK);

  cut_set_message(<span style="color: #95e454;">"hand_draw"</span>);
  h = hand_add(h, c1);
  h = hand_add(h, c2);
  h = hand_add(h, c3);
  h = hand_add(h, c4); 
  h = hand_add(h, c5);

  cut_assert(hand_size(h)==5);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">d</span> = hand_card(h, 1);
  h = hand_draw(h, 1);
  cut_assert(hand_size(h)==4);
  cut_assert(card_compare(d, c2)==0);
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline119" class="outline-5">
<h5 id="orgheadline119">手札のソート</h5>
<div class="outline-text-5" id="text-orgheadline119">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>手札に5枚のカードを加え，</li>
<li>ソート後，昇順に並んでいること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_sort</span>()
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c1</span> = card_new(SPADE, 2);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c2</span> = card_new(HEART, 3);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c3</span> = card_new(CLUB, 4);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c4</span> = card_new(DIAMOND, 5);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c5</span> = card_new(SPADE, 6);

  cut_set_message(<span style="color: #95e454;">"hand_sort"</span>);

  h = hand_add(h, c2);
  h = hand_add(h, c1);
  h = hand_add(h, c3);
  h = hand_add(h, c4);
  h = hand_add(h, c5);

  h = hand_sort(h);

  cut_assert(card_compare(c1, hand_card(h, 0))==0);
  cut_assert(card_compare(c2, hand_card(h, 1))==0);
  cut_assert(card_compare(c3, hand_card(h, 2))==0);
  cut_assert(card_compare(c4, hand_card(h, 3))==0);
  cut_assert(card_compare(c5, hand_card(h, 4))==0);
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline120" class="outline-5">
<h5 id="orgheadline120">手札の文字列化のテスト</h5>
<div class="outline-text-5" id="text-orgheadline120">
<p>
テスト項目
</p>
<ul class="org-ul">
<li>手札に5枚のカードを加え，</li>
<li>その通りに文字列化されること</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_to_string</span>()
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c1</span> = card_new(SPADE, 2);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c2</span> = card_new(HEART, 3);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c3</span> = card_new(CLUB, 4);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c4</span> = card_new(DIAMOND, 5);
  <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c5</span> = card_new(SPADE, 6);

  cut_set_message(<span style="color: #95e454;">"hand_to_string"</span>);

  h = hand_add(h, c1);
  h = hand_add(h, c2);
  h = hand_add(h, c3);
  h = hand_add(h, c4);
  h = hand_add(h, c5);

  <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">s</span> = hand_to_string(h);
  cut_assert(strlen(s)==15);
  cut_assert(strcmp(<span style="color: #95e454;">"S2.H3.C4.D5.S6."</span>, s)==0);
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline130" class="outline-4">
<h4 id="orgheadline130">hand/src/hand.c</h4>
<div class="outline-text-4" id="text-orgheadline130">
</div><div id="outline-container-orgheadline122" class="outline-5">
<h5 id="orgheadline122">Cの標準ラブラリを使う</h5>
</div>

<div id="outline-container-orgheadline123" class="outline-5">
<h5 id="orgheadline123">hand のインタフェースを遵守</h5>
<div class="outline-text-5" id="text-orgheadline123">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline124" class="outline-5">
<h5 id="orgheadline124">hand_new, hand_size</h5>
<div class="outline-text-5" id="text-orgheadline124">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">//</span><span style="color: #99968b;">&#26032;&#12425;&#12375;&#12356;&#25163;&#26413;&#12434;&#20316;&#12427;</span>
<span style="color: #92a65e; font-weight: bold;">Hand</span>
<span style="color: #cae682;">hand_new</span>(<span style="color: #92a65e; font-weight: bold;">void</span>)
{
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>;  <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#25163;&#26413;&#12434;&#20316;&#12427;&#12290;size, cards[5]&#12399;&#21021;&#26399;&#21270;&#12373;&#12428;&#12390;&#12356;&#12394;&#12356;&#12290;</span>

  h.size=0; <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#26522;&#25968;&#12434;0&#12395;&#21021;&#26399;&#21270;&#12377;&#12427;&#12290;</span>
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h; <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#21021;&#26399;&#21270;&#12373;&#12428;&#12383;&#25163;&#26413;&#12434;&#20516;&#12392;&#12375;&#12390;&#36820;&#12377;&#12290;</span>
}

<span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12398;&#26522;&#25968;&#12434;&#27714;&#12417;&#12427;</span>
<span style="color: #92a65e; font-weight: bold;">int</span>
<span style="color: #cae682;">hand_size</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h.size; <span style="color: #99968b;">//</span><span style="color: #99968b;">&#33258;&#26126;</span>
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline125" class="outline-5">
<h5 id="orgheadline125">hand_add</h5>
<div class="outline-text-5" id="text-orgheadline125">
<p>
手札にカードを一枚加える。
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12395;&#12459;&#12540;&#12489;&#12434;&#19968;&#26522;&#21152;&#12360;&#12427;</span>
<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_add</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>, <span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">c</span>)
{
  h.cards[h.size++] = c; <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#33258;&#26126;</span>
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline126" class="outline-5">
<h5 id="orgheadline126">hand_card</h5>
<div class="outline-text-5" id="text-orgheadline126">
<p>
手札の no 番目のカード情報を得る。no は 0~4。
</p>

<p>
手札から1枚カードを捨てる時，つぎのことが必要である:
</p>
<ul class="org-ul">
<li>そのカードを捨て山に積むためのカードの情報 (hand_cardの戻り値)</li>
<li>一枚少なくなった手札自身 (hand_drawの戻り値)</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Card</span> <span style="color: #cae682;">hand_card</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>, <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">no</span>)
{
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h.cards[no];
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline127" class="outline-5">
<h5 id="orgheadline127">hand_draw</h5>
<div class="outline-text-5" id="text-orgheadline127">
<p>
手札から， no 番目のカードを抜く。
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_draw</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>, <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">no</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>;

  <span style="color: #8ac6f2; font-weight: bold;">if</span> (no&gt;h.size)
    <span style="color: #8ac6f2; font-weight: bold;">return</span> h;

  <span style="color: #99968b;">// </span><span style="color: #99968b;">no&#20197;&#38477;&#12434;&#12388;&#12417;&#12427;</span>
  <span style="color: #8ac6f2; font-weight: bold;">for</span>(i=no; i&lt;h.size; i++) 
    {
      h.cards[i]=h.cards[i+1];
    }
  h.size--;
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline128" class="outline-5">
<h5 id="orgheadline128">文字列化</h5>
<div class="outline-text-5" id="text-orgheadline128">
<p>
カードの文字列化をもとに，手札を文字列化する。
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_to_string</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>;
  <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">s</span> = (<span style="color: #92a65e; font-weight: bold;">char</span> *) malloc(<span style="color: #92a65e; font-weight: bold;">CardsInHand</span>*3+1); <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#25991;&#23383;&#21015;&#38936;&#22495;&#30906;&#20445;</span>

  bzero(s,<span style="color: #92a65e; font-weight: bold;">CardsInHand</span>*3+1);   <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#38936;&#22495;&#12398;0&#12463;&#12522;&#12450;</span>

  <span style="color: #8ac6f2; font-weight: bold;">for</span>(i=0; i&lt;hand_size(h); i++)
    {
      strcat(s, card_to_string(hand_card(h,i))); <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#12459;&#12540;&#12489;&#25991;&#23383;&#21015;&#12434;&#35440;&#12417;&#12427;</span>
      strcat(s, <span style="color: #95e454;">"."</span>); <span style="color: #99968b;">//</span><span style="color: #99968b;">** &#21306;&#20999;&#12426;&#12398; . &#12434;&#35440;&#12417;&#12427;</span>
    }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> s;
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline129" class="outline-5">
<h5 id="orgheadline129">hand_sort</h5>
<div class="outline-text-5" id="text-orgheadline129">
<p>
cardモジュールで作った cards_sort の機能がほぼそのまま使える:
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_sort</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #92a65e; font-weight: bold;">Card</span> *<span style="color: #cae682;">cards</span> = h.cards;

  cards = cards_sort(cards, hand_size(h));
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h;
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline132" class="outline-4">
<h4 id="orgheadline132">test/test_judge.c</h4>
<div class="outline-text-4" id="text-orgheadline132">
</div><div id="outline-container-orgheadline131" class="outline-5">
<h5 id="orgheadline131">必要なライブラリのヘッ</h5>
<div class="outline-text-5" id="text-orgheadline131">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;stdio.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;string.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;cutter.h&gt;</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand_test.h&gt;</span>

<span style="color: #92a65e; font-weight: bold;">void</span>
<span style="color: #cae682;">test_hand_judge</span>(<span style="color: #92a65e; font-weight: bold;">void</span>)
{
  <span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">Hand_test</span> *<span style="color: #cae682;">tests</span> = hand_test_data;
  
  <span style="color: #8ac6f2; font-weight: bold;">while</span> ( tests-&gt;y != 0 )
    {
      <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_test_hand_new(tests-&gt;h);
      <span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">y</span> = tests-&gt;y;;
      <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">s</span> = tests-&gt;s;

      h = hand_sort(h);

      {
        <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hj</span> = hand_judge(h);
        <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hs</span> = hand_to_string(h);
      
        cut_set_message
          (<span style="color: #95e454;">"test_judge: hand = %s, PokerHand = %s, y = %d, judge = %d"</span>,
           hs, s, y, hj);
        cut_assert(hj==y);
        cut_assert(strcmp(hand_pokerhand_to_string(y), s)==0);
        tests++;
      }
    }
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline138" class="outline-4">
<h4 id="orgheadline138">hand/src/judge.c</h4>
<div class="outline-text-4" id="text-orgheadline138">
</div><div id="outline-container-orgheadline133" class="outline-5">
<h5 id="orgheadline133">必要なシステムライブラリのインタフェースを読む (定跡)</h5>
<div class="outline-text-5" id="text-orgheadline133">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;stdio.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline134" class="outline-5">
<h5 id="orgheadline134">依存するモジュールのインタフェースを読む(定跡)</h5>
<div class="outline-text-5" id="text-orgheadline134">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;card.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline135" class="outline-5">
<h5 id="orgheadline135">定数の宣言 (定跡)</h5>
<div class="outline-text-5" id="text-orgheadline135">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># define</span> <span style="color: #cae682;">TRUE</span> 1
<span style="color: #e5786d;"># define</span> <span style="color: #cae682;">FALSE</span> 0
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline136" class="outline-5">
<h5 id="orgheadline136">このファイル内でのみ有効な関数の宣言 (定跡)</h5>
<div class="outline-text-5" id="text-orgheadline136">
<p>
hand_calc_pairs, hand_is_stright, hand_is_flush は hand_judge だけ
が知っていればいい。他には見せないようにする。
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#12506;&#12450;&#12363;&#12473;&#12488;&#12524;&#12540;&#12488;&#12289;&#12501;&#12521;&#12483;&#12471;&#12517;&#12434;&#21028;&#23450;&#12377;&#12427;</span>

<span style="color: #8ac6f2; font-weight: bold;">static</span> <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_calc_pairs</span>(Hand); 
<span style="color: #99968b;">// </span><span style="color: #99968b;">5: high card</span>
<span style="color: #99968b;">// </span><span style="color: #99968b;">7: one pair</span>
<span style="color: #99968b;">// </span><span style="color: #99968b;">9: two pair</span>
<span style="color: #99968b;">// </span><span style="color: #99968b;">11: three cards</span>
<span style="color: #99968b;">// </span><span style="color: #99968b;">13: full house</span>
<span style="color: #99968b;">// </span><span style="color: #99968b;">17: four cards</span>
<span style="color: #8ac6f2; font-weight: bold;">static</span> <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_is_straight</span>(Hand);
<span style="color: #8ac6f2; font-weight: bold;">static</span> <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_is_flush</span>(Hand);
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline137" class="outline-5">
<h5 id="orgheadline137">役の計算</h5>
<div class="outline-text-5" id="text-orgheadline137">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">//</span><span style="color: #99968b;">&#25163;&#26413;&#12398;&#24441;&#12398;&#35336;&#31639;</span>
<span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">hand_judge</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  {
    <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">s</span>, <span style="color: #cae682;">f</span>;

    <span style="color: #99968b;">// </span><span style="color: #99968b;">&#12473;&#12488;&#12524;&#12540;&#12488;&#12392;&#12501;&#12521;&#12483;&#12471;&#12517;&#12398;&#21028;&#23450;</span>

    s = hand_is_straight(h);
    f = hand_is_flush(h);

    <span style="color: #8ac6f2; font-weight: bold;">if</span> (s)
      {
        <span style="color: #8ac6f2; font-weight: bold;">if</span> (f) 
          {
            <span style="color: #8ac6f2; font-weight: bold;">return</span> StraightFlush;
          }
        <span style="color: #8ac6f2; font-weight: bold;">else</span>
          {
            <span style="color: #8ac6f2; font-weight: bold;">return</span> Straight;
          }
      }
    <span style="color: #8ac6f2; font-weight: bold;">if</span> (f)
      {
        <span style="color: #8ac6f2; font-weight: bold;">return</span> Flush;
      }
  }
  <span style="color: #99968b;">// </span><span style="color: #99968b;">&#12506;&#12450;&#31995;&#12398;&#21028;&#23450;</span>
  {
    <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">p</span> = hand_calc_pairs(h);
    <span style="color: #8ac6f2; font-weight: bold;">switch</span>(p)
      {
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 5:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> HighCard;
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 7:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> OnePair;
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 9:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> TwoPairs;
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 11:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> ThreeCards;
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 13:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> FullHouse;
      <span style="color: #8ac6f2; font-weight: bold;">case</span> 17:
        <span style="color: #8ac6f2; font-weight: bold;">return</span> FourCards;
      <span style="color: #8ac6f2; font-weight: bold;">default</span>:
        printf(<span style="color: #95e454;">"No such pairs (%d)!\n"</span>, p);
      }
  }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> 0;
}

<span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_calc_pairs</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">p</span>=0;
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>, <span style="color: #cae682;">j</span>;

  <span style="color: #8ac6f2; font-weight: bold;">for</span>(i=0; i&lt;CardsInHand; i++) 
    {
      <span style="color: #8ac6f2; font-weight: bold;">for</span>(j=0; j&lt;CardsInHand; j++)
        {
          <span style="color: #8ac6f2; font-weight: bold;">if</span> (card_no(hand_card(h, i))==card_no(hand_card(h, j)))
            {
              p++;
            }
        }
    }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> p;
}
  
<span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_is_straight</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>;
  
  <span style="color: #8ac6f2; font-weight: bold;">for</span> (i=0; i&lt;4; i++)
    {
      <span style="color: #8ac6f2; font-weight: bold;">if</span> (card_no(hand_card(h, i))!=(card_no(hand_card(h, i+1))-1))
        {
          <span style="color: #8ac6f2; font-weight: bold;">return</span> FALSE;
        }
    }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> TRUE;
}

<span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">hand_is_flush</span>(<span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>;

  <span style="color: #8ac6f2; font-weight: bold;">for</span> (i=0; i&lt;(CardsInHand-1); i++)
    {
      <span style="color: #8ac6f2; font-weight: bold;">if</span> (card_suit(hand_card(h, i))!=card_suit(hand_card(h, i+1)))
        {
          <span style="color: #8ac6f2; font-weight: bold;">return</span> FALSE;
        }
    }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> TRUE;
}

<span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#12434;&#25991;&#23383;&#21015;&#12391;&#34920;&#12377;</span>

<span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#21517;&#25991;&#23383;&#21015;&#12398;&#37197;&#21015;</span>
<span style="color: #8ac6f2; font-weight: bold;">static</span> <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">PokerHandNames</span>[] = 
  { <span style="color: #95e454;">""</span>,
  <span style="color: #95e454;">"HighCard"</span>,
  <span style="color: #95e454;">"OnePair"</span>,
  <span style="color: #95e454;">"TwoPairs"</span>,
  <span style="color: #95e454;">"ThreeCards"</span>,
  <span style="color: #95e454;">"Straight"</span>,
  <span style="color: #95e454;">"Flush"</span>,
  <span style="color: #95e454;">"FullHouse"</span>,
  <span style="color: #95e454;">"FourCards"</span>,
  <span style="color: #95e454;">"StraightFlush"</span>
  };

<span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">hand_pokerhand_to_string</span>(<span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">yaku</span>)
{
  <span style="color: #8ac6f2; font-weight: bold;">return</span> PokerHandNames[yaku];
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline139" class="outline-4">
<h4 id="orgheadline139">hand/test/hand_test.h</h4>
<div class="outline-text-4" id="text-orgheadline139">
<p>
hand_test_data.c はテスト用の手札データを生成するための機能で，
hand_test.h はそのための宣言をおこなっています。
</p>


<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
</pre>
</div>

<ul class="org-ul">
<li>hand のインタフェースを読みます。</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#24441;&#12398;&#12486;&#12473;&#12488;&#12398;&#32068;&#12434;&#20316;&#12427;&#12383;&#12417;&#12398;&#12487;&#12540;&#12479;&#27083;&#36896;&#12392;&#38306;&#25968;</span>

<span style="color: #99968b;">// </span><span style="color: #99968b;">card</span>
<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_card</span> {<span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">suit</span>; <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">no</span>;} ;

<span style="color: #99968b;">// </span><span style="color: #99968b;">hand </span>
<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_hand</span> {<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_card</span> <span style="color: #cae682;">c</span>[5];};
</pre>
</div>

<ul class="org-ul">
<li>card, hand の機能を使わず，テスト側で独自にカードや5枚のカードを
表現するための構造たいです。</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #99968b;">// </span><span style="color: #99968b;">&#25163;&#26413;&#12392;&#24441;&#12392;&#24441;&#12398;&#21517;&#21069;</span>
<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">Hand_test</span> { <span style="color: #92a65e; font-weight: bold;">PokerHand</span> <span style="color: #cae682;">y</span>; <span style="color: #92a65e; font-weight: bold;">char</span> *<span style="color: #cae682;">s</span>; <span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_hand</span> <span style="color: #cae682;">h</span>; };
</pre>
</div>

<ul class="org-ul">
<li>手札 (h) に対し，期待される役 (y), と 手札文字列 (s) を構造体でまと
めたものです。</li>
<li>テストデータをみやすく管理しやすくします。</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #8ac6f2; font-weight: bold;">extern</span> <span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">Hand_test</span> <span style="color: #cae682;">hand_test_data</span>[];;
</pre>
</div>
<ul class="org-ul">
<li>テスト用の Hand_test の配列です。</li>
<li>実際の値は，hand_test_data.c で与えられます。</li>
</ul>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_test_hand_new</span>(<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_hand</span> <span style="color: #cae682;">hs</span>);
</pre>
</div>
<ul class="org-ul">
<li>5枚のカードから手札を作る関数です。</li>
</ul>
</div>
</div>





<div id="outline-container-orgheadline146" class="outline-4">
<h4 id="orgheadline146">hand/test/hand_test_data.c</h4>
<div class="outline-text-4" id="text-orgheadline146">
</div><div id="outline-container-orgheadline140" class="outline-5">
<h5 id="orgheadline140">利用ライブライのヘッダを読む</h5>
<div class="outline-text-5" id="text-orgheadline140">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;string.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline141" class="outline-5">
<h5 id="orgheadline141">利用モジュールのヘッダを読む</h5>
<div class="outline-text-5" id="text-orgheadline141">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;card.h&gt;</span>
<span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline142" class="outline-5">
<h5 id="orgheadline142">手札テストデータ操作用ヘッダを読む</h5>
<div class="outline-text-5" id="text-orgheadline142">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># include</span> <span style="color: #95e454;">&lt;hand_test.h&gt;</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline143" class="outline-5">
<h5 id="orgheadline143">5枚のカードの組のデータ定義</h5>
<div class="outline-text-5" id="text-orgheadline143">
<p>
5枚のカードの組の初期化データに名前をつける
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #e5786d;"># define</span> <span style="color: #cae682;">TEST_HIGHCARD</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"4"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"5"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"7"</span>}}}

<span style="color: #e5786d;"># define</span> <span style="color: #cae682;">TEST_ONEPAIR</span>                                                   \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"4"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"1"</span>}, {<span style="color: #95e454;">"SPADE"</span>, <span style="color: #95e454;">"1"</span>}}}

<span style="color: #e5786d;"># define</span>  <span style="color: #cae682;">TEST_TWOPAIRS</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"4"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"3"</span>}}}
   
<span style="color: #e5786d;"># define</span>  <span style="color: #cae682;">TEST_THREECARDS</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"4"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"HEART"</span>, <span style="color: #95e454;">"2"</span>}}}

<span style="color: #e5786d;"># define</span>  <span style="color: #cae682;">TEST_FULLHOUSE</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"HEART"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"3"</span>}}}

<span style="color: #e5786d;"># define</span>  <span style="color: #cae682;">TEST_FOURCARDS</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"DIAMOND"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"HEART"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"SPADE"</span>, <span style="color: #95e454;">"2"</span>}}}

<span style="color: #e5786d;"># define</span> <span style="color: #cae682;">TEST_STRAIGHTFLUSH</span> \
  {{{<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"2"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"3"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"4"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"5"</span>}, {<span style="color: #95e454;">"CLUB"</span>, <span style="color: #95e454;">"6"</span>}}}
</pre>
</div>
</div>
</div>


<div id="outline-container-orgheadline144" class="outline-5">
<h5 id="orgheadline144">テストデータの初期化</h5>
<div class="outline-text-5" id="text-orgheadline144">
<p>
構造体の配列の初期化データを書く:
</p>

<div class="org-src-container">

<pre class="src src-c"><span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">Hand_test</span> <span style="color: #cae682;">hand_test_data</span>[10] = {
  { .y = HighCard, .s = <span style="color: #95e454;">"HighCard"</span>,   .h = TEST_HIGHCARD},
  { .y = OnePair, .s = <span style="color: #95e454;">"OnePair"</span>, .h = TEST_ONEPAIR},
  { .y = TwoPairs, .s = <span style="color: #95e454;">"TwoPairs"</span>,  .h = TEST_TWOPAIRS},
  { .y = ThreeCards, .s = <span style="color: #95e454;">"ThreeCards"</span>, .h = TEST_THREECARDS}, 
  { .y = FullHouse, .s =  <span style="color: #95e454;">"FullHouse"</span>, .h = TEST_FULLHOUSE}, 
  { .y = FourCards, .s = <span style="color: #95e454;">"FourCards"</span>, .h = TEST_FOURCARDS },
  { .y = StraightFlush, .s = <span style="color: #95e454;">"StraightFlush"</span>, .h = TEST_STRAIGHTFLUSH}
};
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline145" class="outline-5">
<h5 id="orgheadline145">テストデータから Hand型データを生成する機能</h5>
<div class="outline-text-5" id="text-orgheadline145">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">hand_test_hand_new</span>(<span style="color: #8ac6f2; font-weight: bold;">struct</span> <span style="color: #92a65e; font-weight: bold;">t_hand</span> <span style="color: #cae682;">hs</span>)
{
  <span style="color: #92a65e; font-weight: bold;">int</span> <span style="color: #cae682;">i</span>;
  <span style="color: #92a65e; font-weight: bold;">Hand</span> <span style="color: #cae682;">h</span> = hand_new();

  <span style="color: #8ac6f2; font-weight: bold;">for</span>(i=0;i&lt;CardsInHand;i++)
    {
      <span style="color: #8ac6f2; font-weight: bold;">enum</span> <span style="color: #92a65e; font-weight: bold;">e_Suit</span> <span style="color: #cae682;">s</span> = card_suit_new_from_string(hs.c[i].suit);
      <span style="color: #8ac6f2; font-weight: bold;">enum</span> <span style="color: #92a65e; font-weight: bold;">e_No</span> <span style="color: #cae682;">n</span> = card_no_new_from_string(hs.c[i].no);

      h = hand_add(h, card_new(s, n));
    }
  <span style="color: #8ac6f2; font-weight: bold;">return</span> h;
}
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline157" class="outline-2">
<h2 id="orgheadline157">Pokerモジュールの開発</h2>
<div class="outline-text-2" id="text-orgheadline157">
</div><div id="outline-container-orgheadline156" class="outline-3">
<h3 id="orgheadline156">ゲームモジュール</h3>
<div class="outline-text-3" id="text-orgheadline156">
</div><div id="outline-container-orgheadline149" class="outline-4">
<h4 id="orgheadline149">機能、設計，実装</h4>
<div class="outline-text-4" id="text-orgheadline149">
<p>
<a href="http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB">http://wiki.cis.iwate-u.ac.jp/~wiki/prog.cgi?%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB</a>
</p>
</div>

<div id="outline-container-orgheadline150" class="outline-5">
<h5 id="orgheadline150">ゲームの説明からゲームに関する部分を取り出す</h5>
<div class="outline-text-5" id="text-orgheadline150">
<ul class="org-ul">
<li>(5人のプレーヤーに) 手札を配り，</li>

<li>2回までの，(5人のプレーヤーの)手札の交換後，</li>

<li>(5人のプレーヤーの手札役を判定し)</li>

<li>(5人のプレーヤーの)手札役の強い順に，プレーヤ名を表示する</li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline151" class="outline-5">
<h5 id="orgheadline151">poker モジュールの機能</h5>
<div class="outline-text-5" id="text-orgheadline151">
<ul class="org-ul">
<li>ゲームの流れを作る
<ul class="org-ul">
<li>手札を配る</li>
<li>手札の何枚かを交換する</li>
<li>役の判定</li>
<li>表示</li>
</ul></li>
<li>プレーヤーを管理する 
<ul class="org-ul">
<li>手札</li>
<li>名前</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline152" class="outline-5">
<h5 id="orgheadline152">poker モジュールの機能の名前</h5>
<div class="outline-text-5" id="text-orgheadline152">
<ul class="org-ul">
<li>ゲームの流れを作る poker()
<ul class="org-ul">
<li>手札を配る  poker_deal()</li>
<li>手札の何枚かを交換する  poker_exchange()</li>
<li>役の判定  poker_judge()</li>
<li>表示  poker_display()</li>
</ul></li>
<li>プレーヤーを管理する Player
<ul class="org-ul">
<li>手札 .hand</li>
<li>名前 .name</li>
</ul></li>
</ul>
</div>
</div>


<div id="outline-container-orgheadline153" class="outline-5">
<h5 id="orgheadline153">poker モジュールの機能のインタフェース</h5>
<div class="outline-text-5" id="text-orgheadline153">
<ul class="org-ul">
<li>ゲームの流れを作る void poker(void)
<ul class="org-ul">
<li>手札を配る  void poker_deal(void)</li>
<li>手札の何枚かを交換する  void poker_exchange(void)</li>
<li>役の判定  poker_judge(void)</li>
<li>表示  poker_display(void)</li>
</ul></li>

<li>プレーヤーを管理する Player players[NO_PLAYERS]
<ul class="org-ul">
<li>手札 .hand</li>
<li>名前 .name</li>
</ul></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orgheadline154" class="outline-4">
<h4 id="orgheadline154">~/progs/game/poker が開発ディレクトリ</h4>
<div class="outline-text-4" id="text-orgheadline154">
<p>
ここからは，テストを書かずに，実行プログラムを作っていきましょう。
</p>

<ul class="org-ul">
<li>game/poker/poker.h
<ul class="org-ul">
<li>Player の宣言</li>
<li>pokerの機能を表す関数の宣言</li>
</ul></li>

<li>game/poker/poker.c  
<ul class="org-ul">
<li>main</li>
<li>poker_init</li>
<li>poker_deal</li>
<li>poker_exchange</li>
<li>poker_judge</li>
<li>poker_display</li>
</ul></li>

<li>game/poker/Makefile
<ul class="org-ul">
<li>pokerプログラムを作成することが目的</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline155" class="outline-4">
<h4 id="orgheadline155">~/progs/game/Makefile</h4>
<div class="outline-text-4" id="text-orgheadline155">
<p>
各モジュールの管理方法を Makefile に書きましょう。
</p>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">&#33879;&#32773;: masayuki suzuki@cis.iwate-u.ac.jp</p>
<p class="date">Created: 2016-09-25 日 12:23</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
